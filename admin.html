<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุญุฉ ุงูุฅุฏุงุฑุฉ - ูุณุงุฑู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>* { font-family: 'Tajawal', sans-serif; }
    select { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: left 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-left: 2.5rem; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-white to-slate-50 min-h-screen">
    
    <header class="bg-white shadow-sm border-b border-slate-200 sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 bg-gradient-to-br from-slate-700 to-slate-900 rounded-lg flex items-center justify-center text-white">โ๏ธ</div>
                <div><h1 class="text-xl font-bold text-slate-800">ููุญุฉ ุงูุฅุฏุงุฑุฉ</h1><p class="text-xs text-slate-500">ูุณุงุฑู</p></div>
            </div>
            <div class="flex items-center gap-3">
                <a href="index.html" class="px-4 py-2 text-sm text-slate-600 hover:text-slate-800 transition">ุงูุฑุฆูุณูุฉ</a>
                <button onclick="logout()" class="px-4 py-2 bg-red-500 text-white rounded-lg text-sm font-medium hover:bg-red-600 transition">ุฎุฑูุฌ</button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl p-6 text-white shadow-lg">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-sm opacity-90">ุงูุฅูุฑุงุฏุงุช ุงูุดูุฑูุฉ</span>
                    <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">๐ฐ</div>
                </div>
                <p class="text-3xl font-bold mb-1" id="monthlyRevenue">0 ุฑูุงู</p>
                <p class="text-xs opacity-75">+15% ุนู ุงููุงุถู</p>
            </div>
            <div class="bg-gradient-to-br from-indigo-500 to-blue-600 rounded-xl p-6 text-white shadow-lg">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-sm opacity-90">ุงูุงุดุชุฑุงูุงุช ุงููุดุทุฉ</span>
                    <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">๐ฅ</div>
                </div>
                <p class="text-3xl font-bold mb-1" id="activeSubs">0</p>
                <p class="text-xs opacity-75">ุดูุฑู: <span id="mCount">0</span> | ุณููู: <span id="yCount">0</span></p>
            </div>
            <div class="bg-gradient-to-br from-purple-500 to-violet-600 rounded-xl p-6 text-white shadow-lg">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-sm opacity-90">ุงููุณุชุฎุฏููู</span>
                    <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">๐</div>
                </div>
                <p class="text-3xl font-bold mb-1" id="totalUsers">0</p>
                <p class="text-xs opacity-75">+12 ูุฐุง ุงูุฃุณุจูุน</p>
            </div>
            <div class="bg-gradient-to-br from-orange-500 to-amber-600 rounded-xl p-6 text-white shadow-lg">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-sm opacity-90">ุจูู ุงูุฃุณุฆูุฉ</span>
                    <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">๐</div>
                </div>
                <p class="text-3xl font-bold mb-1" id="totalQ">30</p>
                <p class="text-xs opacity-75">ูู 3 ุฃูุณุงู</p>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border mb-8">
            <div class="border-b p-2 flex gap-2 overflow-x-auto">
                <button onclick="switchTab('overview')" id="tab-overview" class="tab-btn active px-6 py-3 rounded-lg font-medium text-sm whitespace-nowrap">๐ ูุธุฑุฉ ุนุงูุฉ</button>
                <button onclick="switchTab('financial')" id="tab-financial" class="tab-btn px-6 py-3 rounded-lg font-medium text-sm whitespace-nowrap">๐ฐ ุงููุงููุฉ</button>
                <button onclick="switchTab('subs')" id="tab-subs" class="tab-btn px-6 py-3 rounded-lg font-medium text-sm whitespace-nowrap">๐ ุงูุงุดุชุฑุงูุงุช</button>
                <button onclick="switchTab('questions')" id="tab-questions" class="tab-btn px-6 py-3 rounded-lg font-medium text-sm whitespace-nowrap">๐ ุงูุฃุณุฆูุฉ</button>
                <button onclick="switchTab('coupons')" id="tab-coupons" class="tab-btn px-6 py-3 rounded-lg font-medium text-sm whitespace-nowrap">๐ซ ุงูููุจููุงุช</button>
                <button onclick="switchTab('staff')" id="tab-staff" class="tab-btn px-6 py-3 rounded-lg font-medium text-sm whitespace-nowrap">๐จโ๐ผ ุงูููุธููู</button>
                <button onclick="switchTab('users')" id="tab-users" class="tab-btn px-6 py-3 rounded-lg font-medium text-sm whitespace-nowrap">๐ฅ ุงููุณุชุฎุฏููู</button>
            </div>
            
            <div class="p-6">
                <div id="content-overview" class="tab-content"><h2 class="text-2xl font-bold mb-6">ูุธุฑุฉ ุนุงูุฉ</h2><div class="bg-slate-50 rounded-xl p-6"><p class="text-center text-slate-600">ุงูุฑุณูู ุงูุจูุงููุฉ ูุฑูุจุงู</p></div></div>
                <div id="content-financial" class="tab-content hidden"><h2 class="text-2xl font-bold mb-6">ุงููุงููุฉ</h2><div class="grid md:grid-cols-3 gap-6"><div class="bg-white border rounded-xl p-6"><p class="text-sm text-slate-600 mb-2">ุงูููู</p><p class="text-3xl font-bold text-green-600">0 ุฑูุงู</p></div><div class="bg-white border rounded-xl p-6"><p class="text-sm text-slate-600 mb-2">ุงูุฃุณุจูุน</p><p class="text-3xl font-bold text-blue-600">0 ุฑูุงู</p></div><div class="bg-white border rounded-xl p-6"><p class="text-sm text-slate-600 mb-2">ุงูุดูุฑ</p><p class="text-3xl font-bold text-indigo-600" id="monthRev">0 ุฑูุงู</p></div></div></div>
                <div id="content-subs" class="tab-content hidden"><h2 class="text-2xl font-bold mb-6">ุงูุงุดุชุฑุงูุงุช</h2><div class="bg-white border rounded-xl p-6 overflow-x-auto"><table class="w-full"><thead><tr class="border-b"><th class="text-right py-3 px-4 text-sm">ุงููุณุชุฎุฏู</th><th class="text-right py-3 px-4 text-sm">ุงูุจุงูุฉ</th><th class="text-right py-3 px-4 text-sm">ุงูุญุงูุฉ</th><th class="text-center py-3 px-4 text-sm">ุฅุฌุฑุงุกุงุช</th></tr></thead><tbody id="subsList"><tr><td colspan="4" class="text-center py-8 text-slate-500">ูุง ุชูุฌุฏ ุงุดุชุฑุงูุงุช</td></tr></tbody></table></div></div>

                <div id="content-questions" class="tab-content hidden">
                    <div class="flex justify-between mb-6 flex-wrap gap-3">
                        <h2 class="text-2xl font-bold">ุงูุฃุณุฆูุฉ</h2>
                        <div class="flex gap-3">
                            <button onclick="showBulkModal()" class="px-4 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 shadow-sm">๐ฆ ุฅุถุงูุฉ ุฌูุงุนูุฉ</button>
                            <button onclick="showAddModal()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 shadow-sm">+ ุฅุถุงูุฉ ุณุคุงู</button>
                        </div>
                    </div>
                    
                    <div class="flex gap-3 mb-4 flex-wrap">
                        <select id="filterSection" onchange="loadQ()" class="px-4 py-2.5 border-2 border-slate-300 rounded-xl focus:border-indigo-500 focus:outline-none transition bg-white shadow-sm font-medium">
                            <option value="all">ูู ุงูุฃูุณุงู</option>
                            <option value="quantitative">ูุฏุฑุงุช ููู</option>
                            <option value="verbal">ูุฏุฑุงุช ููุธู</option>
                            <option value="achievement">ุชุญุตููู</option>
                        </select>
                        <select id="filterDiff" onchange="loadQ()" class="px-4 py-2.5 border-2 border-slate-300 rounded-xl focus:border-indigo-500 focus:outline-none transition bg-white shadow-sm font-medium">
                            <option value="all">ูู ุงููุณุชููุงุช</option>
                            <option value="easy">ุณูู</option>
                            <option value="medium">ูุชูุณุท</option>
                            <option value="hard">ุตุนุจ</option>
                        </select>
                    </div>
                    
                    <div class="space-y-3" id="qList"><p class="text-center text-slate-500 py-12">ุฌุงุฑู ุงูุชุญููู...</p></div>
                </div>

                <div id="content-coupons" class="tab-content hidden">
                    <div class="flex justify-between mb-6">
                        <h2 class="text-2xl font-bold">ุฅุฏุงุฑุฉ ุงูููุจููุงุช</h2>
                        <button onclick="showCouponModal()" class="px-4 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700">+ ุฅูุดุงุก ููุจูู</button>
                    </div>
                    <div class="grid md:grid-cols-3 gap-6 mb-6">
                        <div class="bg-white border rounded-xl p-6"><p class="text-sm text-slate-600 mb-2">ุงูููุจููุงุช ุงููุดุทุฉ</p><p class="text-3xl font-bold text-green-600" id="activeCoupons">0</p></div>
                        <div class="bg-white border rounded-xl p-6"><p class="text-sm text-slate-600 mb-2">ุงููุณุชุฎุฏูุฉ</p><p class="text-3xl font-bold text-blue-600" id="usedCoupons">0</p></div>
                        <div class="bg-white border rounded-xl p-6"><p class="text-sm text-slate-600 mb-2">ุงูุฎุตู ุงูุฅุฌูุงูู</p><p class="text-3xl font-bold text-indigo-600" id="totalDiscount">0 ุฑูุงู</p></div>
                    </div>
                    <div class="bg-white border rounded-xl p-6 overflow-x-auto"><table class="w-full"><thead><tr class="border-b"><th class="text-right py-3 px-4 text-sm">ุงูููุฏ</th><th class="text-right py-3 px-4 text-sm">ุงูุฎุตู</th><th class="text-right py-3 px-4 text-sm">ุงูุงุณุชุฎุฏุงูุงุช</th><th class="text-right py-3 px-4 text-sm">ุงูุงูุชูุงุก</th><th class="text-center py-3 px-4 text-sm">ุฅุฌุฑุงุกุงุช</th></tr></thead><tbody id="couponsList"><tr><td colspan="5" class="text-center py-8 text-slate-500">ูุง ุชูุฌุฏ ููุจููุงุช</td></tr></tbody></table></div>
                </div>

                <div id="content-users" class="tab-content hidden">
                    <h2 class="text-2xl font-bold mb-6">ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</h2>
                    <div class="grid md:grid-cols-3 gap-6 mb-6">
                        <div class="bg-white border rounded-xl p-6"><p class="text-sm text-slate-600 mb-2">ุงููุณุฌููู ุงูุฌุฏุฏ (ุงูููู)</p><p class="text-3xl font-bold text-green-600" id="newUsers">0</p></div>
                        <div class="bg-white border rounded-xl p-6"><p class="text-sm text-slate-600 mb-2">ุงููุดุชุฑููู ุงููุฏููุนูู</p><p class="text-3xl font-bold text-blue-600" id="paidUsers">0</p></div>
                        <div class="bg-white border rounded-xl p-6"><p class="text-sm text-slate-600 mb-2">ุงููุฌุงูููู</p><p class="text-3xl font-bold text-slate-600" id="freeUsers">0</p></div>
                    </div>
                    <div class="bg-white border rounded-xl p-6 overflow-x-auto"><table class="w-full"><thead><tr class="border-b"><th class="text-right py-3 px-4 text-sm">ุงูุงุณู</th><th class="text-right py-3 px-4 text-sm">ุงูุจุฑูุฏ</th><th class="text-right py-3 px-4 text-sm">ุงูุจุงูุฉ</th><th class="text-right py-3 px-4 text-sm">ุงูุชุณุฌูู</th><th class="text-center py-3 px-4 text-sm">ุฅุฌุฑุงุกุงุช</th></tr></thead><tbody id="usersList"><tr><td colspan="5" class="text-center py-8 text-slate-500">ูุง ุชูุฌุฏ ุจูุงูุงุช</td></tr></tbody></table></div>
                </div>

                <div id="content-staff" class="tab-content hidden">
                    <div class="flex justify-between mb-6 flex-wrap gap-3">
                        <h2 class="text-2xl font-bold">ุฅุฏุงุฑุฉ ุงูููุธููู ูุงูุตูุงุญูุงุช</h2>
                        <button onclick="showAddStaffModal()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 shadow-sm">+ ุฅุถุงูุฉ ููุธู</button>
                    </div>

                    <div class="grid md:grid-cols-4 gap-6 mb-6">
                        <div class="bg-gradient-to-br from-indigo-100 to-blue-100 border-2 border-indigo-300 rounded-xl p-6">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-10 h-10 bg-indigo-500 rounded-lg flex items-center justify-center">
                                    <span class="text-white text-xl">๐</span>
                                </div>
                                <p class="text-sm text-indigo-800 font-medium">ุงููุฏูุฑูู</p>
                            </div>
                            <p class="text-3xl font-bold text-indigo-900" id="adminCount">1</p>
                            <p class="text-xs text-indigo-700 mt-1">ูุงูู ุงูุตูุงุญูุงุช</p>
                        </div>

                        <div class="bg-gradient-to-br from-green-100 to-emerald-100 border-2 border-green-300 rounded-xl p-6">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center">
                                    <span class="text-white text-xl">๐จโ๐ซ</span>
                                </div>
                                <p class="text-sm text-green-800 font-medium">ุงููุนูููู</p>
                            </div>
                            <p class="text-3xl font-bold text-green-900" id="teacherCount">0</p>
                            <p class="text-xs text-green-700 mt-1">ุฅุฏุงุฑุฉ ุงูุฃุณุฆูุฉ</p>
                        </div>

                        <div class="bg-gradient-to-br from-amber-100 to-yellow-100 border-2 border-amber-300 rounded-xl p-6">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-10 h-10 bg-amber-500 rounded-lg flex items-center justify-center">
                                    <span class="text-white text-xl">๐ง</span>
                                </div>
                                <p class="text-sm text-amber-800 font-medium">ุงูุฏุนู ุงูููู</p>
                            </div>
                            <p class="text-3xl font-bold text-amber-900" id="supportCount">0</p>
                            <p class="text-xs text-amber-700 mt-1">ุนุฑุถ ุงููุณุชุฎุฏููู</p>
                        </div>

                        <div class="bg-gradient-to-br from-slate-100 to-gray-100 border-2 border-slate-300 rounded-xl p-6">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-10 h-10 bg-slate-500 rounded-lg flex items-center justify-center">
                                    <span class="text-white text-xl">๐ฅ</span>
                                </div>
                                <p class="text-sm text-slate-800 font-medium">ุฅุฌูุงูู ุงููุฑูู</p>
                            </div>
                            <p class="text-3xl font-bold text-slate-900" id="totalStaff">1</p>
                            <p class="text-xs text-slate-700 mt-1">ูุดุทูู</p>
                        </div>
                    </div>

                    <div class="bg-white border rounded-xl p-6 overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b">
                                    <th class="text-right py-3 px-4 text-sm font-bold text-gray-700">ุงูุงุณู</th>
                                    <th class="text-right py-3 px-4 text-sm font-bold text-gray-700">ุงูุจุฑูุฏ</th>
                                    <th class="text-right py-3 px-4 text-sm font-bold text-gray-700">ุงูุฏูุฑ</th>
                                    <th class="text-right py-3 px-4 text-sm font-bold text-gray-700">ุงูุตูุงุญูุงุช</th>
                                    <th class="text-right py-3 px-4 text-sm font-bold text-gray-700">ุชุงุฑูุฎ ุงูุฅุถุงูุฉ</th>
                                    <th class="text-center py-3 px-4 text-sm font-bold text-gray-700">ุฅุฌุฑุงุกุงุช</th>
                                </tr>
                            </thead>
                            <tbody id="staffList">
                                <tr>
                                    <td class="py-4 px-4 border-b">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 bg-indigo-500 rounded-full flex items-center justify-center text-white font-bold">ุน</div>
                                            <span class="font-medium">ุนุจุฏุงููู (ุฃูุช)</span>
                                        </div>
                                    </td>
                                    <td class="py-4 px-4 border-b text-gray-600"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="98ecfdebecd8f9fcf5f1f6b6fbf7f5">[email&#160;protected]</a></td>
                                    <td class="py-4 px-4 border-b">
                                        <span class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs font-bold">๐ ูุฏูุฑ</span>
                                    </td>
                                    <td class="py-4 px-4 border-b text-gray-600 text-sm">ูุงูู ุงูุตูุงุญูุงุช</td>
                                    <td class="py-4 px-4 border-b text-gray-500 text-sm">22 ุดุนุจุงู, 1447 ูู</td>
                                    <td class="py-4 px-4 border-b text-center">
                                        <span class="text-gray-400 text-xs">-</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="mt-6 bg-blue-50 border-2 border-blue-200 rounded-xl p-6">
                        <h3 class="font-bold text-blue-900 mb-3 flex items-center gap-2">
                            <span>โน๏ธ</span>
                            ุฏููู ุงูุตูุงุญูุงุช
                        </h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-start gap-3">
                                <span class="text-indigo-600 font-bold">๐ ูุฏูุฑ:</span>
                                <span class="text-gray-700">ูุงูู ุงูุตูุงุญูุงุช - ุฅุฏุงุฑุฉ ูู ุดู (ุงูุฃุณุฆูุฉุ ุงููุณุชุฎุฏูููุ ุงูููุธูููุ ุงููุงููุฉุ ุงูููุจููุงุช)</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <span class="text-green-600 font-bold">๐จโ๐ซ ูุนูู:</span>
                                <span class="text-gray-700">ุฅุถุงูุฉ ูุชุนุฏูู ุงูุฃุณุฆูุฉ ููุท - ูุง ููุฏุฑ ูุดูู ุจูุงูุงุช ุงููุณุชุฎุฏููู ุฃู ุงููุงููุฉ</span>
                            </div>
                            <div class="flex items-start gap-3">
                                <span class="text-amber-600 font-bold">๐ง ุฏุนู ููู:</span>
                                <span class="text-gray-700">ุนุฑุถ ุงููุณุชุฎุฏููู ููุณุงุนุฏุชูู ููุท - ูุง ููุฏุฑ ูุนุฏู ุงูุฃุณุฆูุฉ ุฃู ูุดูู ุงููุงููุฉ</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Add/Edit Question Modal -->
    <div id="addModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-6 max-w-3xl w-full max-h-[85vh] overflow-y-auto">
            <div class="flex justify-between mb-4 sticky top-0 bg-white pb-3 border-b">
                <h3 class="text-xl font-bold" id="modalTitle">ุฅุถุงูุฉ ุณุคุงู ุฌุฏูุฏ</h3>
                <button onclick="closeAddModal()" class="text-slate-500 hover:text-slate-700 text-2xl leading-none">โ</button>
            </div>
            <form id="addForm" onsubmit="saveQ(event)" class="space-y-4">
                <input type="hidden" id="editingId">
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block font-medium mb-2">ุงููุณู *</label>
                        <select id="qSec" required class="w-full px-4 py-2.5 border-2 border-slate-300 rounded-xl focus:border-indigo-500 focus:outline-none transition bg-white shadow-sm" onchange="updateSubjects()">
                            <option value="">ุงุฎุชุฑ ุงููุณู</option>
                            <option value="quantitative">ูุฏุฑุงุช ููู</option>
                            <option value="verbal">ูุฏุฑุงุช ููุธู</option>
                            <option value="achievement">ุชุญุตููู</option>
                        </select>
                    </div>
                    <div>
                        <label class="block font-medium mb-2">ุงููุงุฏุฉ/ุงูููุถูุน *</label>
                        <select id="qSub" required class="w-full px-4 py-2.5 border-2 border-slate-300 rounded-xl focus:border-indigo-500 focus:outline-none transition bg-white shadow-sm">
                            <option value="">ุงุฎุชุฑ ุงููุณู ุฃููุงู</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block font-medium mb-2">ุงูุตุนูุจุฉ *</label>
                    <div class="grid grid-cols-3 gap-3">
                        <button type="button" onclick="setDiff('easy')" id="diff-easy" class="px-4 py-3 border-2 rounded-xl hover:border-green-500 transition font-medium">ุณูู</button>
                        <button type="button" onclick="setDiff('medium')" id="diff-medium" class="px-4 py-3 border-2 rounded-xl hover:border-amber-500 transition font-medium">ูุชูุณุท</button>
                        <button type="button" onclick="setDiff('hard')" id="diff-hard" class="px-4 py-3 border-2 rounded-xl hover:border-red-500 transition font-medium">ุตุนุจ</button>
                    </div>
                    <input type="hidden" id="qDiff" required>
                </div>
                <div>
                    <label class="block font-medium mb-2">ูุต ุงูุณุคุงู *</label>
                    <textarea id="qText" required rows="3" placeholder="ุงูุชุจ ุงูุณุคุงู ููุง..." class="w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-indigo-500 focus:outline-none transition"></textarea>
                </div>
                <div>
                    <label class="block font-medium mb-2">ุงููุนุงุฏูุฉ (ุงุฎุชูุงุฑู)</label>
                    <input type="text" id="qEq" placeholder="ูุซูุงู: 5 ร ุณ = 25" class="w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-indigo-500 focus:outline-none transition">
                </div>
                <div>
                    <label class="block font-medium mb-2">ุตูุฑุฉ ุงูุณุคุงู (ุงุฎุชูุงุฑู)</label>
                    <input type="file" id="qImg" accept="image/*" class="w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-indigo-500 focus:outline-none transition" onchange="previewImage(event)">
                    <div id="imgPreview" class="mt-2"></div>
                </div>
                <div>
                    <label class="block font-medium mb-2">ุงูุฎูุงุฑุงุช (4 ุฎูุงุฑุงุช) *</label>
                    <div class="space-y-2">
                        <input type="text" id="op1" required placeholder="ุงูุฎูุงุฑ 1" class="w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-indigo-500 focus:outline-none transition">
                        <input type="text" id="op2" required placeholder="ุงูุฎูุงุฑ 2" class="w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-indigo-500 focus:outline-none transition">
                        <input type="text" id="op3" required placeholder="ุงูุฎูุงุฑ 3" class="w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-indigo-500 focus:outline-none transition">
                        <input type="text" id="op4" required placeholder="ุงูุฎูุงุฑ 4" class="w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-indigo-500 focus:outline-none transition">
                    </div>
                </div>
                <div>
                    <label class="block font-medium mb-2">ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ *</label>
                    <select id="qAns" required class="w-full px-4 py-2.5 border-2 border-slate-300 rounded-xl focus:border-indigo-500 focus:outline-none transition bg-white shadow-sm">
                        <option value="">ุงุฎุชุฑ ุงูุฅุฌุงุจุฉ</option>
                        <option value="0">ุงูุฎูุงุฑ 1</option>
                        <option value="1">ุงูุฎูุงุฑ 2</option>
                        <option value="2">ุงูุฎูุงุฑ 3</option>
                        <option value="3">ุงูุฎูุงุฑ 4</option>
                    </select>
                </div>
                <div>
                    <label class="block font-medium mb-2">ุงูุดุฑุญ *</label>
                    <textarea id="qExp" required rows="3" placeholder="ุงุดุฑุญ ุทุฑููุฉ ุงูุญู..." class="w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-indigo-500 focus:outline-none transition"></textarea>
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="submit" class="flex-1 bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 shadow-lg">ุญูุธ ุงูุณุคุงู</button>
                    <button type="button" onclick="closeAddModal()" class="px-6 bg-slate-200 py-3 rounded-xl hover:bg-slate-300 font-medium">ุฅูุบุงุก</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Import Modal -->
    <div id="bulkModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-8 max-w-3xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between mb-6">
                <h3 class="text-2xl font-bold">ุฅุถุงูุฉ ูุฌููุนุฉ ุฃุณุฆูุฉ</h3>
                <button onclick="closeBulkModal()" class="text-slate-500 hover:text-slate-700 text-2xl">โ</button>
            </div>
            <div class="mb-6"><p class="text-slate-600 mb-4">ุงูุตู JSON ููุง:</p><div class="bg-slate-50 rounded p-4 mb-4"><p class="text-xs text-slate-500 mb-2">ูุซุงู:</p><pre class="text-xs bg-slate-800 text-green-400 p-3 rounded overflow-x-auto">[{"section":"quantitative","subject":"ุงูุฌุจุฑ","difficulty":"easy","question":"ุญู: 2รุณ=10","equation":"2รุณ=10","options":["3","5","7","10"],"correctAnswer":1,"explanation":"ููุณู ุนูู 2"}]</pre></div></div>
            <form onsubmit="bulkImport(event)"><textarea id="bulkInput" rows="10" class="w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-green-500 focus:outline-none transition font-mono text-sm" placeholder='[{...}]'></textarea><div class="flex gap-3 mt-4"><button type="submit" class="flex-1 bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 shadow-lg">ุงุณุชูุฑุงุฏ ุงูุฃุณุฆูุฉ</button><button type="button" onclick="closeBulkModal()" class="px-6 bg-slate-200 py-3 rounded-xl hover:bg-slate-300 font-medium">ุฅูุบุงุก</button></div></form>
        </div>
    </div>

    <!-- Coupon Modal -->
    <div id="couponModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full">
            <div class="flex justify-between mb-6">
                <h3 class="text-2xl font-bold">ุฅูุดุงุก ููุจูู ุฎุตู</h3>
                <button onclick="closeCouponModal()" class="text-slate-500 hover:text-slate-700 text-2xl">โ</button>
            </div>
            <form id="couponForm" onsubmit="createCoupon(event)" class="space-y-4">
                <div><label class="block font-medium mb-2">ููุฏ ุงูููุจูู *</label><input type="text" id="couponCode" required placeholder="ูุซูุงู: WELCOME50" class="w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-green-500 focus:outline-none transition uppercase"></div>
                <div><label class="block font-medium mb-2">ููุน ุงูุฎุตู *</label><div class="grid grid-cols-2 gap-3"><button type="button" onclick="setDiscountType('percentage')" id="type-percentage" class="px-4 py-3 border-2 rounded-xl hover:border-indigo-500 transition font-medium">ูุณุจุฉ ูุฆููุฉ %</button><button type="button" onclick="setDiscountType('fixed')" id="type-fixed" class="px-4 py-3 border-2 rounded-xl hover:border-green-500 transition font-medium">ูุจูุบ ุซุงุจุช (ุฑูุงู)</button></div><input type="hidden" id="discountType" required></div>
                <div><label class="block font-medium mb-2">ูููุฉ ุงูุฎุตู *</label><input type="number" id="discountValue" required min="1" placeholder="ูุซูุงู: 50" class="w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-green-500 focus:outline-none transition"></div>
                <div><label class="block font-medium mb-2">ุนุฏุฏ ุงูุงุณุชุฎุฏุงูุงุช *</label><input type="number" id="maxUses" required min="1" value="100" class="w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-green-500 focus:outline-none transition"></div>
                <div><label class="block font-medium mb-2">ุชุงุฑูุฎ ุงูุงูุชูุงุก *</label><input type="date" id="expiryDate" required class="w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-green-500 focus:outline-none transition"></div>
                <div class="flex gap-3 pt-4"><button type="submit" class="flex-1 bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 shadow-lg">ุฅูุดุงุก ุงูููุจูู</button><button type="button" onclick="closeCouponModal()" class="px-6 bg-slate-200 py-3 rounded-xl hover:bg-slate-300 font-medium">ุฅูุบุงุก</button></div>
            </form>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="editUserModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full">
            <div class="flex justify-between mb-6">
                <h3 class="text-2xl font-bold">ุชุนุฏูู ุจูุงูุงุช ุงููุณุชุฎุฏู</h3>
                <button onclick="closeEditUserModal()" class="text-slate-500 hover:text-slate-700 text-2xl">โ</button>
            </div>
            <form id="editUserForm" onsubmit="saveUserEdit(event)" class="space-y-4">
                <input type="hidden" id="editUserId">
                <div><label class="block font-medium mb-2">ุงูุงุณู</label><input type="text" id="editUserName" required class="w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-indigo-500 focus:outline-none transition"></div>
                <div><label class="block font-medium mb-2">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label><input type="email" id="editUserEmail" required class="w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-indigo-500 focus:outline-none transition"></div>
                <div><label class="block font-medium mb-2">ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ (ุงุฎุชูุงุฑู)</label><input type="password" id="editUserPassword" placeholder="ุงุชุฑูู ูุงุฑุบุงู ููุฅุจูุงุก ุนูู ุงููุฏููุฉ" class="w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-indigo-500 focus:outline-none transition"></div>
                <div><label class="block font-medium mb-2">ุฑูู ุงูุฌูุงู (ุงุฎุชูุงุฑู)</label><input type="tel" id="editUserPhone" placeholder="05xxxxxxxx" class="w-full px-4 py-3 border-2 border-slate-300 rounded-xl focus:border-indigo-500 focus:outline-none transition"></div>
                <div class="flex gap-3 pt-4"><button type="submit" class="flex-1 bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 shadow-lg">ุญูุธ ุงูุชุบููุฑุงุช</button><button type="button" onclick="closeEditUserModal()" class="px-6 bg-slate-200 py-3 rounded-xl hover:bg-slate-300 font-medium">ุฅูุบุงุก</button></div>
            </form>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="questions_bank.js"></script>
    <script>
        const subjects = {quantitative: ['ุงูุฌุจุฑ', 'ุงูููุฏุณุฉ', 'ุงููุณุจุฉ ูุงูุชูุงุณุจ', 'ุงูุฃุนุฏุงุฏ', 'ุงููุณูุฑ', 'ุงููุณุงุฆู ุงูููุงููุฉ', 'ุงูุฅุญุตุงุก'], verbal: ['ุงูุชูุงุธุฑ ุงูููุธู', 'ุฅููุงู ุงูุฌูู', 'ุงูุฎุทุฃ ุงูุณูุงูู', 'ุงูุงุณุชูุนุงุจ ุงูููุฑูุก'], achievement: ['ุงูุฑูุงุถูุงุช', 'ุงูููุฒูุงุก', 'ุงูููููุงุก', 'ุงูุฃุญูุงุก', 'ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ']};
        let allQ = [...questionsBank];
        const saved = localStorage.getItem('masari_custom_questions');
        if (saved) { try { allQ = JSON.parse(saved); } catch(e) {} }
        let coupons = JSON.parse(localStorage.getItem('masari_coupons') || '[]');
        let editingQId = null;
        
        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => {b.classList.remove('active', 'bg-indigo-100', 'text-indigo-700'); b.classList.add('text-slate-600');});
            document.getElementById('content-' + t).classList.remove('hidden');
            const a = document.getElementById('tab-' + t);
            a.classList.add('active', 'bg-indigo-100', 'text-indigo-700');
            a.classList.remove('text-slate-600');
            if (t === 'questions') loadQ(); else if (t === 'financial') loadFin(); else if (t === 'subs') loadSubs(); else if (t === 'coupons') loadCoupons(); else if (t === 'users') loadUsers();
        }

        function loadStats() {
            document.getElementById('totalQ').textContent = allQ.length;
            const u = JSON.parse(localStorage.getItem('masari_user') || 'null');
            document.getElementById('totalUsers').textContent = u ? 1 : 0;
            const s = JSON.parse(localStorage.getItem('masari_subscription') || 'null');
            if (s) {
                document.getElementById('activeSubs').textContent = 1;
                if (s.plan === 'monthly') {document.getElementById('mCount').textContent = 1; document.getElementById('monthlyRevenue').textContent = '29 ุฑูุงู'; document.getElementById('monthRev').textContent = '29 ุฑูุงู';} else {document.getElementById('yCount').textContent = 1; document.getElementById('monthlyRevenue').textContent = '228 ุฑูุงู'; document.getElementById('monthRev').textContent = '228 ุฑูุงู';}
            }
        }

        function loadFin() {}
        function loadSubs() {
            const s = JSON.parse(localStorage.getItem('masari_subscription') || 'null');
            if (!s) return;
            const u = JSON.parse(localStorage.getItem('masari_user'));
            const p = s.plan === 'monthly' ? 'ุดูุฑู' : 'ุณููู';
            const d = new Date(s.startDate).toLocaleDateString('ar-SA');
            document.getElementById('subsList').innerHTML = `<tr class="border-b"><td class="py-3 px-4 text-sm">${u.name}</td><td class="py-3 px-4 text-sm"><span class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs">${p}</span></td><td class="py-3 px-4 text-sm"><span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">ูุดุท</span></td><td class="py-3 px-4 text-center"><button class="text-sm text-indigo-600 hover:text-indigo-700" onclick="sendCouponToUser()">ุฅุฑุณุงู ููุจูู</button></td></tr>`;
        }

        function updateSubjects() {
            const sec = document.getElementById('qSec').value;
            const subSel = document.getElementById('qSub');
            subSel.innerHTML = '<option value="">ุงุฎุชุฑ ุงูููุถูุน</option>';
            if (sec && subjects[sec]) { subjects[sec].forEach(s => { subSel.innerHTML += `<option value="${s}">${s}</option>`; }); }
        }

        let selectedDiff = null;
        function setDiff(d) {
            selectedDiff = d;
            document.getElementById('qDiff').value = d;
            ['easy', 'medium', 'hard'].forEach(x => {
                const btn = document.getElementById('diff-' + x);
                btn.classList.remove('border-green-500', 'bg-green-50', 'border-amber-500', 'bg-amber-50', 'border-red-500', 'bg-red-50');
            });
            const colors = {easy: 'green', medium: 'amber', hard: 'red'};
            const btn = document.getElementById('diff-' + d);
            btn.classList.add(`border-${colors[d]}-500`, `bg-${colors[d]}-50`);
        }

        let qImage = null;
        function previewImage(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(ev) {
                    qImage = ev.target.result;
                    document.getElementById('imgPreview').innerHTML = `<img src="${qImage}" class="max-w-xs rounded-lg border">`;
                };
                reader.readAsDataURL(file);
            }
        }

        function showAddModal() {
            editingQId = null;
            document.getElementById('modalTitle').textContent = 'ุฅุถุงูุฉ ุณุคุงู ุฌุฏูุฏ';
            document.getElementById('addModal').classList.remove('hidden');
        }
        
        function closeAddModal() {
            document.getElementById('addModal').classList.add('hidden');
            document.getElementById('addForm').reset();
            editingQId = null;
            qImage = null;
            document.getElementById('imgPreview').innerHTML = '';
        }

        function editQ(id) {
            const q = allQ.find(x => x.id === id);
            if (!q) return;
            editingQId = id;
            document.getElementById('modalTitle').textContent = 'ุชุนุฏูู ุงูุณุคุงู';
            document.getElementById('qSec').value = q.section;
            updateSubjects();
            setTimeout(() => { document.getElementById('qSub').value = q.subject; }, 100);
            setDiff(q.difficulty);
            document.getElementById('qText').value = q.question;
            document.getElementById('qEq').value = q.equation || '';
            document.getElementById('op1').value = q.options[0];
            document.getElementById('op2').value = q.options[1];
            document.getElementById('op3').value = q.options[2];
            document.getElementById('op4').value = q.options[3];
            document.getElementById('qAns').value = q.correctAnswer;
            document.getElementById('qExp').value = q.explanation;
            if (q.image) {
                qImage = q.image;
                document.getElementById('imgPreview').innerHTML = `<img src="${qImage}" class="max-w-xs rounded-lg border">`;
            }
            document.getElementById('addModal').classList.remove('hidden');
        }

        function saveQ(e) {
            e.preventDefault();
            const data = {
                section: document.getElementById('qSec').value,
                subject: document.getElementById('qSub').value,
                difficulty: document.getElementById('qDiff').value,
                question: document.getElementById('qText').value,
                equation: document.getElementById('qEq').value || '',
                image: qImage || '',
                options: [document.getElementById('op1').value, document.getElementById('op2').value, document.getElementById('op3').value, document.getElementById('op4').value],
                correctAnswer: parseInt(document.getElementById('qAns').value),
                explanation: document.getElementById('qExp').value
            };
            
            if (editingQId) {
                const idx = allQ.findIndex(q => q.id === editingQId);
                allQ[idx] = {...allQ[idx], ...data};
                alert('โ ุชู ุชุญุฏูุซ ุงูุณุคุงู');
            } else {
                data.id = allQ.length + 1;
                allQ.push(data);
                alert('โ ุชู ุฅุถุงูุฉ ุงูุณุคุงู');
            }
            
            localStorage.setItem('masari_custom_questions', JSON.stringify(allQ));
            closeAddModal();
            loadQ();
            loadStats();
        }

        function loadQ() {
            const c = document.getElementById('qList');
            const secF = document.getElementById('filterSection')?.value || 'all';
            const difF = document.getElementById('filterDiff')?.value || 'all';
            let filtered = allQ;
            if (secF !== 'all') filtered = filtered.filter(q => q.section === secF);
            if (difF !== 'all') filtered = filtered.filter(q => q.difficulty === difF);
            if (filtered.length === 0) { c.innerHTML = '<p class="text-center text-slate-500 py-12">ูุง ุชูุฌุฏ ุฃุณุฆูุฉ</p>'; return; }
            const dc = {easy: 'bg-green-100 text-green-700', medium: 'bg-amber-100 text-amber-700', hard: 'bg-red-100 text-red-700'};
            const dt = {easy: 'ุณูู', medium: 'ูุชูุณุท', hard: 'ุตุนุจ'};
            const st = {quantitative: 'ูุฏุฑุงุช ููู', verbal: 'ูุฏุฑุงุช ููุธู', achievement: 'ุชุญุตููู'};
            c.innerHTML = filtered.map(q => `
                <div class="bg-white border-2 border-slate-200 rounded-xl p-5 hover:shadow-lg hover:border-indigo-300 transition">
                    <div class="flex justify-between">
                        <div class="flex-1">
                            <div class="flex gap-2 mb-3 flex-wrap">
                                <span class="px-3 py-1 ${dc[q.difficulty]} rounded-lg text-xs font-bold">${dt[q.difficulty]}</span>
                                <span class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-lg text-xs font-bold">${st[q.section]}</span>
                                <span class="px-3 py-1 bg-slate-100 text-slate-700 rounded-lg text-xs font-bold">${q.subject}</span>
                                <span class="text-xs text-slate-500 font-mono">#${q.id}</span>
                            </div>
                            <p class="text-slate-800 mb-2 font-medium">${q.question}</p>
                            ${q.equation ? `<p class="text-sm text-slate-600 font-mono bg-slate-50 px-3 py-2 rounded-lg inline-block">${q.equation}</p>` : ''}
                            ${q.image ? `<img src="${q.image}" class="max-w-xs mt-3 rounded-lg border-2 shadow-sm">` : ''}
                        </div>
                        <div class="flex flex-col gap-2">
                            <button class="text-sm text-indigo-600 hover:text-indigo-700 font-medium px-3 py-1 rounded hover:bg-indigo-50" onclick="editQ(${q.id})">ุชุนุฏูู</button>
                            <button class="text-sm text-red-600 hover:text-red-700 font-medium px-3 py-1 rounded hover:bg-red-50" onclick="delQ(${q.id})">ุญุฐู</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function delQ(id) {
            if (!confirm('ูุชุฃูุฏ ุชุจู ุชุญุฐู ูุงูุณุคุงูุ')) return;
            allQ = allQ.filter(q => q.id !== id);
            localStorage.setItem('masari_custom_questions', JSON.stringify(allQ));
            loadQ(); loadStats();
        }

        function showBulkModal() { document.getElementById('bulkModal').classList.remove('hidden'); }
        function closeBulkModal() { document.getElementById('bulkModal').classList.add('hidden'); document.getElementById('bulkInput').value = ''; }
        
        function bulkImport(e) {
            e.preventDefault();
            const input = document.getElementById('bulkInput').value;
            try {
                const questions = JSON.parse(input);
                if (!Array.isArray(questions)) { alert('โ ุงูุตูุบุฉ ุบูุฑ ุตุญูุญุฉุ ูุฌุจ ุฃู ุชููู ูุตูููุฉ'); return; }
                let startId = allQ.length + 1;
                questions.forEach((q, index) => { allQ.push({...q, id: startId + index}); });
                localStorage.setItem('masari_custom_questions', JSON.stringify(allQ));
                alert(`โ ุชู ุฅุถุงูุฉ ${questions.length} ุณุคุงู ุจูุฌุงุญ`);
                closeBulkModal(); loadQ(); loadStats();
            } catch (e) { alert('โ ุฎุทุฃ ูู ุงูุตูุบุฉุ ุชุฃูุฏ ูู ุตุญุฉ JSON'); }
        }

        function showCouponModal() { document.getElementById('couponModal').classList.remove('hidden'); }
        function closeCouponModal() { document.getElementById('couponModal').classList.add('hidden'); document.getElementById('couponForm').reset(); }

        let discType = null;
        function setDiscountType(t) {
            discType = t;
            document.getElementById('discountType').value = t;
            ['percentage', 'fixed'].forEach(x => { const btn = document.getElementById('type-' + x); btn.classList.remove('border-indigo-500', 'bg-indigo-50', 'border-green-500', 'bg-green-50'); });
            const colors = {percentage: 'indigo', fixed: 'green'};
            document.getElementById('type-' + t).classList.add(`border-${colors[t]}-500`, `bg-${colors[t]}-50`);
        }

        function createCoupon(e) {
            e.preventDefault();
            const coup = {id: Date.now(), code: document.getElementById('couponCode').value.toUpperCase(), type: document.getElementById('discountType').value, value: parseInt(document.getElementById('discountValue').value), maxUses: parseInt(document.getElementById('maxUses').value), used: 0, expiry: document.getElementById('expiryDate').value, createdAt: Date.now()};
            coupons.push(coup);
            localStorage.setItem('masari_coupons', JSON.stringify(coupons));
            alert('โ ุชู ุฅูุดุงุก ุงูููุจูู ุจูุฌุงุญ');
            closeCouponModal(); loadCoupons();
        }

        function loadCoupons() {
            const active = coupons.filter(c => new Date(c.expiry) > new Date() && c.used < c.maxUses).length;
            const used = coupons.reduce((sum, c) => sum + c.used, 0);
            const totalDisc = coupons.reduce((sum, c) => { if (c.type === 'fixed') return sum + (c.value * c.used); return sum; }, 0);
            document.getElementById('activeCoupons').textContent = active;
            document.getElementById('usedCoupons').textContent = used;
            document.getElementById('totalDiscount').textContent = totalDisc + ' ุฑูุงู';
            const list = document.getElementById('couponsList');
            if (coupons.length === 0) { list.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-slate-500">ูุง ุชูุฌุฏ ููุจููุงุช</td></tr>'; return; }
            list.innerHTML = coupons.map(c => {
                const expired = new Date(c.expiry) < new Date();
                const full = c.used >= c.maxUses;
                const status = expired ? 'ููุชูู' : full ? 'ูุณุชููุฐ' : 'ูุดุท';
                const statusColor = expired || full ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700';
                const discount = c.type === 'percentage' ? `${c.value}%` : `${c.value} ุฑูุงู`;
                return `<tr class="border-b"><td class="py-3 px-4 text-sm font-mono font-bold">${c.code}</td><td class="py-3 px-4 text-sm">${discount}</td><td class="py-3 px-4 text-sm">${c.used} / ${c.maxUses}</td><td class="py-3 px-4 text-sm">${c.expiry}</td><td class="py-3 px-4 text-center"><span class="px-2 py-1 ${statusColor} rounded text-xs">${status}</span> <button class="text-sm text-red-600 hover:text-red-700 mr-2" onclick="deleteCoupon(${c.id})">ุญุฐู</button></td></tr>`;
            }).join('');
        }

        function deleteCoupon(id) { if (!confirm('ูุชุฃูุฏ ุชุจู ุชุญุฐู ูุงูููุจููุ')) return; coupons = coupons.filter(c => c.id !== id); localStorage.setItem('masari_coupons', JSON.stringify(coupons)); loadCoupons(); }
        function sendCouponToUser() { const code = prompt('ุฃุฏุฎู ููุฏ ุงูููุจูู ููุฅุฑุณุงู:'); if (code) { alert(`โ ุชู ุฅุฑุณุงู ุงูููุจูู ${code} ูููุณุชุฎุฏู`); } }

        function loadUsers() {
            const u = JSON.parse(localStorage.getItem('masari_user') || 'null');
            const s = JSON.parse(localStorage.getItem('masari_subscription') || 'null');
            if (!u) { document.getElementById('usersList').innerHTML = '<tr><td colspan="5" class="text-center py-8 text-slate-500">ูุง ุชูุฌุฏ ุจูุงูุงุช</td></tr>'; return; }
            const plan = s ? (s.plan === 'monthly' ? 'ุดูุฑู' : 'ุณููู') : 'ูุฌุงูู';
            const planColor = s ? 'bg-indigo-100 text-indigo-700' : 'bg-slate-100 text-slate-700';
            const date = new Date(u.createdAt).toLocaleDateString('ar-SA');
            document.getElementById('newUsers').textContent = 1;
            document.getElementById('paidUsers').textContent = s ? 1 : 0;
            document.getElementById('freeUsers').textContent = s ? 0 : 1;
            document.getElementById('usersList').innerHTML = `<tr class="border-b"><td class="py-3 px-4 text-sm">${u.name}</td><td class="py-3 px-4 text-sm">${u.email}</td><td class="py-3 px-4 text-sm"><span class="px-2 py-1 ${planColor} rounded text-xs">${plan}</span></td><td class="py-3 px-4 text-sm text-slate-500">${date}</td><td class="py-3 px-4 text-center"><button class="text-sm text-indigo-600 hover:text-indigo-700 mr-2" onclick="editUser()">ุชุนุฏูู</button><button class="text-sm text-green-600 hover:text-green-700" onclick="sendCouponToUser()">ุฅุฑุณุงู ููุจูู</button></td></tr>`;
        }

        function editUser() {
            const u = JSON.parse(localStorage.getItem('masari_user'));
            document.getElementById('editUserId').value = 'current';
            document.getElementById('editUserName').value = u.name;
            document.getElementById('editUserEmail').value = u.email;
            document.getElementById('editUserPhone').value = u.phone || '';
            document.getElementById('editUserModal').classList.remove('hidden');
        }

        function closeEditUserModal() { document.getElementById('editUserModal').classList.add('hidden'); }
        
        function saveUserEdit(e) {
            e.preventDefault();
            const u = JSON.parse(localStorage.getItem('masari_user'));
            u.name = document.getElementById('editUserName').value;
            u.email = document.getElementById('editUserEmail').value;
            const newPass = document.getElementById('editUserPassword').value;
            if (newPass) u.password = newPass;
            u.phone = document.getElementById('editUserPhone').value;
            localStorage.setItem('masari_user', JSON.stringify(u));
            alert('โ ุชู ุญูุธ ุงูุชุบููุฑุงุช');
            closeEditUserModal(); loadUsers();
        }

        function logout() { if (confirm('ูุชุฃูุฏ ุชุจู ุชุณุฌู ุฎุฑูุฌุ')) window.location.href = 'index.html'; }

        loadStats();
        const style = document.createElement('style');
        sty
        // Tab switching function
        function switchTab(tabName) {
            // Hide all content
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            // Remove active from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active', 'bg-indigo-100', 'text-indigo-700'));
            // Show selected content
            const content = document.getElementById('content-' + tabName);
            if (content) content.classList.remove('hidden');
            // Activate button
            const button = document.getElementById('tab-' + tabName);
            if (button) button.classList.add('active', 'bg-indigo-100', 'text-indigo-700');
        }
    </script>
</body>
</html>
