<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ù…Ø¯Ø§Ø±Ùƒ Ø§Ù„Ù†Ø®Ø¨Ø©</title>
    <!-- âœ… FAVICON Ù…Ø¶Ø§Ù -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%236366f1'/%3E%3Cstop offset='100%25' stop-color='%238b5cf6'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='64' height='64' rx='14' fill='url(%23g)'/%3E%3Cpath d='M10 50 L10 30 L19 39 L32 14 L45 39 L54 30 L54 50Z' stroke='white' stroke-width='3' stroke-linecap='round' stroke-linejoin='round' fill='none'/%3E%3Cline x1='10' y1='54' x2='54' y2='54' stroke='white' stroke-width='3' stroke-linecap='round'/%3E%3Ccircle cx='10' cy='30' r='3' fill='white'/%3E%3Ccircle cx='32' cy='14' r='3' fill='white'/%3E%3Ccircle cx='54' cy='30' r='3' fill='white'/%3E%3C/svg%3E">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        *{font-family:'Tajawal',sans-serif}
        body{background:linear-gradient(135deg,#0f0a2e 0%,#1a1145 30%,#1e1550 50%,#151040 70%,#0d0825 100%);min-height:100vh}
        .glass{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);backdrop-filter:blur(20px);border-radius:1rem}
        .sidebar{background:rgba(15,10,46,0.97);border-left:1px solid rgba(255,255,255,0.06);min-height:100vh;width:240px;position:fixed;top:0;right:0;z-index:40;overflow-y:auto}
        .sb-link{display:flex;align-items:center;gap:12px;padding:12px 18px;border-radius:.75rem;font-size:.9rem;font-weight:700;color:rgba(196,181,253,0.5);transition:all .2s;cursor:pointer;margin:3px 10px}
        .sb-link:hover{background:rgba(255,255,255,0.05);color:rgba(196,181,253,0.8)}
        .sb-link.on{background:rgba(99,102,241,0.15);color:#a5b4fc;border:1px solid rgba(99,102,241,0.2)}
        .mc{margin-right:240px;padding:28px;min-height:100vh}
        .inp{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:.75rem;padding:.75rem 1rem;color:#fff;width:100%;font-size:.95rem;transition:all .2s}
        .inp:focus{outline:none;border-color:rgba(139,92,246,0.5);box-shadow:0 0 0 3px rgba(139,92,246,0.1)}
        .inp::placeholder{color:rgba(255,255,255,0.2)}
        .inp option{background:#1a1145;color:#fff}
        .bp{background:linear-gradient(135deg,#6366f1,#8b5cf6);padding:10px 24px;border-radius:.75rem;font-weight:700;font-size:.9rem;color:#fff;transition:all .2s;border:none;cursor:pointer}
        .bp:hover{box-shadow:0 8px 25px rgba(99,102,241,0.3);transform:translateY(-1px)}
        .bd{background:rgba(239,68,68,0.15);border:1px solid rgba(239,68,68,0.2);color:#f87171;padding:8px 16px;border-radius:.75rem;font-size:.85rem;font-weight:600;cursor:pointer}
        .bs{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);color:#c4b5fd;padding:8px 16px;border-radius:.75rem;font-size:.85rem;font-weight:600;cursor:pointer}
        .sc{transition:all .3s}.sc:hover{transform:translateY(-3px)}
        .tr{border-bottom:1px solid rgba(255,255,255,0.04)}.tr:hover{background:rgba(255,255,255,0.03)}
        .bg{display:inline-block;padding:3px 12px;border-radius:999px;font-size:.8rem;font-weight:700}
        .bg-f{background:rgba(251,191,36,0.1);color:#fbbf24;border:1px solid rgba(251,191,36,0.2)}
        .bg-m{background:rgba(99,102,241,0.1);color:#818cf8;border:1px solid rgba(99,102,241,0.2)}
        .bg-y{background:rgba(16,185,129,0.1);color:#34d399;border:1px solid rgba(16,185,129,0.2)}
        .bg-a{background:rgba(239,68,68,0.1);color:#f87171;border:1px solid rgba(239,68,68,0.2)}
        .tab{display:none}.tab.on{display:block}
        .toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);padding:12px 28px;border-radius:12px;font-size:.95rem;font-weight:700;z-index:999;animation:sd .4s ease}
        .tok{background:linear-gradient(135deg,#10b981,#14b8a6);color:#fff}
        .ter{background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff}
        @keyframes sd{from{opacity:0;transform:translateX(-50%) translateY(-20px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
        .mbg{position:fixed;inset:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(5px);z-index:50;display:flex;align-items:center;justify-content:center;padding:16px}
        .mbox{background:linear-gradient(135deg,#1a1145,#1e1550);border:1px solid rgba(139,92,246,0.2);border-radius:1.25rem;padding:28px;width:100%;max-width:540px;max-height:85vh;overflow-y:auto}
        .rr{display:flex;align-items:center;gap:12px;padding:10px 14px;border-radius:.75rem}.rr:hover{background:rgba(255,255,255,0.03)}
        .rn{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:.8rem;flex-shrink:0}
        @media(max-width:768px){.sidebar{display:none}.mc{margin-right:0;padding:16px}}
        .perm-card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.07);border-radius:.875rem;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
        .toggle-wrap{position:relative;width:50px;height:28px;flex-shrink:0}
        .toggle-wrap input{opacity:0;width:0;height:0;position:absolute}
        .toggle-track{position:absolute;inset:0;background:rgba(255,255,255,0.1);border-radius:28px;cursor:pointer;transition:.3s;border:1px solid rgba(255,255,255,0.08)}
        .toggle-track:before{content:'';position:absolute;width:22px;height:22px;background:#fff;border-radius:50%;top:2px;right:2px;transition:.3s}
        .toggle-wrap input:checked+.toggle-track{background:linear-gradient(135deg,#6366f1,#8b5cf6)}
        .toggle-wrap input:checked+.toggle-track:before{transform:translateX(-22px)}
        .role-box{border:2px solid transparent;border-radius:1rem;padding:14px;cursor:pointer;transition:all .2s;text-align:center}
        .role-box.admin-sel{background:rgba(239,68,68,0.12);border-color:rgba(239,68,68,0.5)!important}
        .role-box.staff-sel{background:rgba(139,92,246,0.12);border-color:rgba(139,92,246,0.5)!important}
        .badge-admin{background:rgba(239,68,68,0.12);color:#f87171;border:1px solid rgba(239,68,68,0.25);padding:2px 10px;border-radius:999px;font-size:.75rem;font-weight:700;display:inline-block}
        .badge-staff{background:rgba(139,92,246,0.12);color:#c4b5fd;border:1px solid rgba(139,92,246,0.25);padding:2px 10px;border-radius:999px;font-size:.75rem;font-weight:700;display:inline-block}
        /* âœ… Online indicator */
        .online-dot{width:8px;height:8px;border-radius:50%;background:#10b981;display:inline-block;margin-left:4px;box-shadow:0 0 6px #10b981;animation:pulse-dot 2s infinite}
        @keyframes pulse-dot{0%,100%{opacity:1}50%{opacity:.4}}
        /* Madarek Logo */
        @keyframes spin-ring{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
        @keyframes shimmer{0%{background-position:200% center}100%{background-position:-200% center}}
        @keyframes glow-pulse{0%,100%{box-shadow:0 4px 20px rgba(99,102,241,0.35)}50%{box-shadow:0 8px 32px rgba(99,102,241,0.6)}}
        .madarek-logo{display:inline-flex;align-items:center;gap:10px;direction:rtl;text-decoration:none;user-select:none}
        .madarek-logo .icon{width:38px;height:38px;border-radius:11px;flex-shrink:0;background:linear-gradient(135deg,#1e1b4b,#2d2564);border:1.5px solid rgba(99,102,241,0.35);display:flex;align-items:center;justify-content:center;position:relative;animation:glow-pulse 3s ease-in-out infinite}
        .madarek-logo .icon .ring{position:absolute;inset:3px;border-radius:8px;border:1.5px solid transparent;border-top-color:rgba(99,102,241,0.8);border-right-color:rgba(139,92,246,0.4);animation:spin-ring 3s linear infinite}
        .madarek-logo .name{font-family:'Cairo',sans-serif;font-size:17px;font-weight:900;background:linear-gradient(110deg,#c7d2fe 0%,#e0e7ff 20%,#818cf8 45%,#c4b5fd 70%,#c7d2fe 100%);background-size:300% auto;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:shimmer 5s linear infinite;line-height:1.1}
        .madarek-logo .tag{font-size:9px;color:rgba(196,181,253,0.4);margin-top:1px;display:block;font-family:'Tajawal',sans-serif}
        /* âœ… Duplicate warning */
        .dup-warn{background:rgba(251,191,36,0.1);border:1px solid rgba(251,191,36,0.3);border-radius:.75rem;padding:12px 16px;margin-top:8px;display:none}

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           âœ… RICH TEXT EDITOR â€” Ù…Ø­Ø±Ø± Ø§Ù„Ù†ØµÙˆØµ
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .editor-wrap{border:1px solid rgba(255,255,255,0.1);border-radius:.75rem;overflow:hidden;background:rgba(255,255,255,0.06)}
        .editor-wrap:focus-within{border-color:rgba(139,92,246,0.5);box-shadow:0 0 0 3px rgba(139,92,246,0.1)}

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª */
        .editor-toolbar{
            background:rgba(255,255,255,0.04);
            border-bottom:1px solid rgba(255,255,255,0.08);
            padding:6px 10px;
            display:flex;
            flex-wrap:wrap;
            gap:2px;
            align-items:center;
        }
        .tb-btn{
            width:30px;height:30px;border-radius:6px;border:none;
            background:transparent;color:rgba(196,181,253,0.7);
            cursor:pointer;font-size:.85rem;display:flex;align-items:center;justify-content:center;
            transition:all .15s;flex-shrink:0;
        }
        .tb-btn:hover{background:rgba(99,102,241,0.2);color:#a5b4fc}
        .tb-btn.active{background:rgba(99,102,241,0.3);color:#c4b5fd}
        .tb-sep{width:1px;height:20px;background:rgba(255,255,255,0.1);margin:0 4px;flex-shrink:0}
        .tb-select{
            background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);
            color:rgba(196,181,253,0.8);border-radius:6px;padding:2px 6px;font-size:.75rem;
            cursor:pointer;height:28px;
        }
        .tb-select option{background:#1a1145;color:#fff}
        .tb-color{width:28px;height:28px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);cursor:pointer;padding:2px;background:transparent}

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© */
        .editor-body{
            min-height:100px;max-height:300px;overflow-y:auto;
            padding:12px 16px;color:#fff;font-size:.95rem;line-height:1.8;
            outline:none;direction:rtl;text-align:right;
        }
        .editor-body:empty:before{content:attr(data-placeholder);color:rgba(255,255,255,0.2);pointer-events:none}
        .editor-body p{margin:0;min-height:1.5em}
        .editor-body .ltr-block{direction:ltr;text-align:left;unicode-bidi:bidi-override}
        /* Ø±Ù…ÙˆØ² Ø±ÙŠØ§Ø¶ÙŠØ© */
        .math-sym{
            display:inline-block;background:rgba(99,102,241,0.15);border:1px solid rgba(99,102,241,0.3);
            border-radius:4px;padding:1px 6px;font-family:monospace;font-size:.9em;color:#a5b4fc;
            user-select:text;
        }

        /* âœ… Ø£Ø¯Ø§Ø© Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„ØªÙƒØ±Ø§Ø± */
        .dup-tool-wrap{background:rgba(99,102,241,0.05);border:1px solid rgba(99,102,241,0.15);border-radius:1rem;padding:16px;margin-bottom:16px}
        .dup-result-item{display:flex;align-items:flex-start;gap:10px;padding:10px 12px;border-radius:.75rem;background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.15);margin-top:8px}
    </style>
</head>
<body class="text-white">
<div id="toast" class="toast hidden"></div>

<!-- Sidebar -->
<aside class="sidebar">
    <div class="p-4 mb-2">
        <div class="madarek-logo mb-1">
            <div class="icon">
                <div class="ring"></div>
                <svg viewBox="0 0 36 36" width="20" height="20" fill="none">
                    <path d="M5 26 L5 14 L11.5 20 L18 7 L24.5 20 L31 14 L31 26 Z" stroke="rgba(165,180,252,0.95)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <line x1="5" y1="28.5" x2="31" y2="28.5" stroke="rgba(165,180,252,0.7)" stroke-width="2.5" stroke-linecap="round"/>
                    <circle cx="5"  cy="14" r="2.5" fill="#a5b4fc"/>
                    <circle cx="18" cy="7"  r="2.5" fill="#c4b5fd"/>
                    <circle cx="31" cy="14" r="2.5" fill="#a5b4fc"/>
                </svg>
            </div>
            <div style="display:flex;flex-direction:column;align-items:flex-end">
                <span class="name">Ù…Ø¯Ø§Ø±Ùƒ Ø§Ù„Ù†Ø®Ø¨Ø©</span>
                <span class="tag">Ø­ÙŠØ« ÙŠÙØµÙ†Ø¹ Ø§Ù„ØªÙ…ÙŠÙ‘Ø²</span>
            </div>
        </div>
        <p class="text-[10px] text-purple-200/50 mr-1">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
    </div>
    <div class="sb-link on" data-tab="overview"><span>ğŸ“Š</span><span>Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</span></div>
    <div class="sb-link" data-tab="questions" data-perm="questions"><span>ğŸ“</span><span>Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</span></div>
    <div class="sb-link" data-tab="users" data-perm="users"><span>ğŸ‘¥</span><span>Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</span></div>
    <div class="sb-link" data-tab="coupons" data-perm="coupons"><span>ğŸŸï¸</span><span>Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª</span></div>
    <div class="sb-link" data-tab="finance" data-perm="finance"><span>ğŸ’°</span><span>Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span></div>
    <div class="sb-link" data-tab="reports" data-perm="reports"><span>ğŸš©</span><span>Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</span></div>
    <div class="sb-link" data-tab="staff" data-perm="staff"><span>ğŸ”‘</span><span>Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</span></div>
    <div class="sb-link" data-tab="settings" data-perm="settings"><span>âš™ï¸</span><span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></div>
    <div class="mt-4 p-4 border-t border-purple-500/10">
        <div class="sb-link" onclick="sb.auth.signOut().then(function(){location.href='admin-login.html'})" style="color:#f87171"><span>ğŸšª</span><span>ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</span></div>
    </div>
</aside>

<!-- Main -->
<div class="mc">

<!-- â•â•â• Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© (âœ… Ù…ÙˆØ³Ù‘Ø¹Ø©) â•â•â• -->
<div id="t-overview" class="tab on">
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-black">ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</h2>
        <!-- âœ… Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ø§Ù„Ø­ÙŠÙ† -->
        <div class="glass px-4 py-2 flex items-center gap-2">
            <span class="online-dot"></span>
            <span class="text-sm text-emerald-400 font-bold" id="s-online">0</span>
            <span class="text-sm text-purple-200/60">Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†</span>
        </div>
    </div>

    <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div class="sc glass p-5 text-center"><p class="text-purple-300/50 text-sm mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</p><p class="text-4xl font-black text-indigo-400" id="s-q">-</p></div>
        <div class="sc glass p-5 text-center"><p class="text-purple-300/50 text-sm mb-1">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</p><p class="text-4xl font-black text-emerald-400" id="s-u">-</p></div>
        <div class="sc glass p-5 text-center"><p class="text-purple-300/50 text-sm mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</p><p class="text-4xl font-black text-purple-400" id="s-a">-</p></div>
        <div class="sc glass p-5 text-center"><p class="text-purple-300/50 text-sm mb-1">Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</p><p class="text-4xl font-black text-red-400" id="s-r">-</p></div>
    </div>

    <!-- âœ… Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div class="glass p-4 text-center" style="border-color:rgba(16,185,129,0.2)"><p class="text-emerald-400/70 text-xs mb-1">Ù…Ø´ØªØ±ÙƒÙŠÙ† ÙØ¹Ø§Ù„ÙŠÙ†</p><p class="text-3xl font-black text-emerald-400" id="ov-active">-</p></div>
        <div class="glass p-4 text-center" style="border-color:rgba(99,102,241,0.2)"><p class="text-indigo-400/70 text-xs mb-1">Ø´Ù‡Ø±ÙŠ</p><p class="text-3xl font-black text-indigo-400" id="ov-monthly">-</p></div>
        <div class="glass p-4 text-center" style="border-color:rgba(139,92,246,0.2)"><p class="text-purple-400/70 text-xs mb-1">Ø³Ù†ÙˆÙŠ</p><p class="text-3xl font-black text-purple-400" id="ov-yearly">-</p></div>
        <div class="glass p-4 text-center" style="border-color:rgba(251,191,36,0.2)"><p class="text-yellow-400/70 text-xs mb-1">Ù…Ø¬Ø§Ù†ÙŠ</p><p class="text-3xl font-black text-yellow-400" id="ov-free">-</p></div>
    </div>

    <div class="grid lg:grid-cols-2 gap-4 mb-6">
        <div class="glass p-6"><h3 class="font-bold text-base mb-4">ğŸ“ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…</h3><div id="d-sec" class="space-y-3"></div></div>
        <div class="glass p-6"><h3 class="font-bold text-base mb-4">ğŸ”¥ Ø£ÙƒØ«Ø± Ø³Ø¤Ø§Ù„ ÙŠØºÙ„Ø·ÙˆÙ† ÙÙŠÙ‡</h3><div id="d-hard" class="text-purple-300/50">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>
    </div>
    <div class="grid lg:grid-cols-3 gap-4 mb-6">
        <div class="glass p-6"><h3 class="font-bold text-base mb-4">ğŸ† Ø£ÙƒØ«Ø± Ø­Ù„ÙˆÙ„Ø§Ù‹</h3><div id="d-top"></div></div>
        <div class="glass p-6"><h3 class="font-bold text-base mb-4">ğŸ¯ Ø£Ø¹Ù„Ù‰ Ù†Ø³Ø¨Ø© ØµØ­</h3><div id="d-acc"></div></div>
        <div class="glass p-6"><h3 class="font-bold text-base mb-4">âš¡ Ø£Ù†Ø´Ø· (Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…)</h3><div id="d-act"></div></div>
    </div>
    <div class="grid lg:grid-cols-2 gap-4 mb-6">
        <div class="glass p-6 text-center"><h3 class="font-bold text-base mb-4">ğŸ“ˆ Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¹Ø§Ù…Ø©</h3><p class="text-5xl font-black text-emerald-400" id="d-rate">-</p><p class="text-purple-200/70 text-sm mt-1">Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</p></div>
        <div class="glass p-6"><h3 class="font-bold text-base mb-4">ğŸ†• Ø£Ø­Ø¯Ø« Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h3><div id="d-new"></div></div>
    </div>
    <!-- âœ… Ø¢Ø®Ø± Ù†Ø´Ø§Ø· -->
    <div class="glass p-6">
        <h3 class="font-bold text-base mb-4">ğŸ• Ø¢Ø®Ø± Ù†Ø´Ø§Ø· Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©</h3>
        <div id="d-recent" class="space-y-2"></div>
    </div>
</div>

<!-- â•â•â• Ø§Ù„Ø£Ø³Ø¦Ù„Ø© â•â•â• -->
<div id="t-questions" class="tab">
    <div class="flex items-center justify-between mb-5"><h2 class="text-2xl font-black">ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h2><button class="bp" onclick="openQM()">+ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„</button></div>

    <!-- âœ… Ø£Ø¯Ø§Ø© Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„Ù…ÙƒØ±Ø±Ø§Øª -->
    <div class="dup-tool-wrap mb-4">
        <div class="flex items-center justify-between mb-3">
            <div>
                <p class="font-bold text-white text-sm">ğŸ” ÙƒØ´Ù Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ÙƒØ±Ø±Ø©</p>
                <p class="text-purple-200/50 text-xs mt-1">ÙŠØ¨Ø­Ø« Ø¹Ù† Ø£Ø³Ø¦Ù„Ø© Ù…ØªØ´Ø§Ø¨Ù‡Ø© ÙÙŠ Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</p>
            </div>
            <button class="bp" style="padding:8px 18px;font-size:.85rem" onclick="scanDuplicates()">ÙØ­Øµ Ø§Ù„Ø¢Ù†</button>
        </div>
        <div id="dup-scan-result" class="hidden">
            <div id="dup-scan-list" class="space-y-2 max-h-60 overflow-y-auto"></div>
        </div>
    </div>

    <div class="flex gap-2 mb-4">
        <select id="qf" class="inp" style="max-width:160px" onchange="loadQ()"><option value="all">ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option><option value="quant">ÙƒÙ…ÙŠ</option><option value="verbal">Ù„ÙØ¸ÙŠ</option><option value="tahsili">ØªØ­ØµÙŠÙ„ÙŠ</option></select>
        <input type="text" id="qs" class="inp" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©..." oninput="loadQ()">
    </div>
    <div id="q-list" class="space-y-2"></div>
</div>

<!-- â•â•â• Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ â•â•â• -->
<div id="t-users" class="tab">
    <h2 class="text-2xl font-black mb-5">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h2>
    <input type="text" id="us" class="inp mb-4" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„..." oninput="loadU()">
    <div class="glass overflow-x-auto"><table class="w-full text-sm"><thead><tr class="border-b border-purple-500/10"><th class="text-right p-3 text-purple-300/50 text-sm">Ø§Ù„Ø¹Ø¶Ùˆ</th><th class="text-right p-3 text-purple-300/50 text-sm">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th><th class="text-center p-3 text-purple-300/50 text-sm">Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th><th class="text-center p-3 text-purple-300/50 text-sm">Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th><th class="text-center p-3 text-purple-300/50 text-sm">Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead><tbody id="u-list"></tbody></table></div>
</div>

<!-- â•â•â• Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª â•â•â• -->
<div id="t-coupons" class="tab">
    <div class="flex items-center justify-between mb-5"><h2 class="text-2xl font-black">ğŸŸï¸ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª</h2><button class="bp" onclick="$('couponM').classList.remove('hidden')">+ ÙƒÙˆØ¨ÙˆÙ† Ø¬Ø¯ÙŠØ¯</button></div>
    <!-- âœ… ØªÙ†Ø¨ÙŠÙ‡ ØªÙˆØ¶ÙŠØ­ÙŠ -->
    <div class="glass p-4 mb-4" style="border-color:rgba(99,102,241,0.2);background:rgba(99,102,241,0.05)">
        <p class="text-indigo-300 text-sm font-bold mb-1">â„¹ï¸ ÙƒÙŠÙ ØªØ´ØªØºÙ„ Ù…Ø¯Ø© Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†ØŸ</p>
        <p class="text-purple-200/60 text-xs">Ù…Ø¯Ø© Ø§Ù„ÙƒÙˆØ¨ÙˆÙ† = Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù„ÙŠ ÙŠØ­ØµÙ„ Ø¹Ù„ÙŠÙ‡Ø§ Ø§Ù„Ø¹Ø¶Ùˆ. Ù…Ø«Ù„Ø§Ù‹: ÙƒÙˆØ¨ÙˆÙ† "Ø´Ù‡Ø± ÙˆØ§Ø­Ø¯" â† Ø§Ù„Ø¹Ø¶Ùˆ ÙŠØ´ØªØ±Ùƒ Ø´Ù‡Ø± Ù…Ø¬Ø§Ù†Ø§Ù‹ Ø¨ØºØ¶ Ø§Ù„Ù†Ø¸Ø± Ø¹Ù† Ø§Ù„Ø¨Ø§Ù‚Ø©. ÙƒÙˆØ¨ÙˆÙ† "Ø³Ù†Ø©" â† ÙŠØ´ØªØ±Ùƒ Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø©.</p>
    </div>
    <div class="glass overflow-x-auto"><table class="w-full text-sm"><thead><tr class="border-b border-purple-500/10"><th class="text-right p-3 text-purple-300/50">Ø§Ù„ÙƒÙˆØ¯</th><th class="text-center p-3 text-purple-300/50">Ø§Ù„Ø®ØµÙ…</th><th class="text-center p-3 text-purple-300/50">ÙŠØ·Ø¨Ù‘Ù‚ Ø¹Ù„Ù‰</th><th class="text-center p-3 text-purple-300/50">Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th><th class="text-center p-3 text-purple-300/50">Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</th><th class="text-center p-3 text-purple-300/50">Ø§Ù„Ø­Ø§Ù„Ø©</th><th class="text-center p-3 text-purple-300/50">Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead><tbody id="c-list"></tbody></table></div>
</div>

<!-- â•â•â• Ø§Ù„Ù…Ø§Ù„ÙŠØ© â•â•â• -->
<div id="t-finance" class="tab">
    <h2 class="text-2xl font-black mb-5">ğŸ’° Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h2>
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="sc glass p-5 text-center"><p class="text-purple-300/50 text-sm mb-1">Ù…Ø´ØªØ±ÙƒÙŠÙ† ÙØ¹Ø§Ù„ÙŠÙ†</p><p class="text-4xl font-black text-emerald-400" id="f-a">-</p></div>
        <div class="sc glass p-5 text-center"><p class="text-purple-300/50 text-sm mb-1">Ø´Ù‡Ø±ÙŠ</p><p class="text-4xl font-black text-indigo-400" id="f-m">-</p></div>
        <div class="sc glass p-5 text-center"><p class="text-purple-300/50 text-sm mb-1">Ø³Ù†ÙˆÙŠ</p><p class="text-4xl font-black text-purple-400" id="f-y">-</p></div>
        <div class="sc glass p-5 text-center"><p class="text-purple-300/50 text-sm mb-1">Ù…Ø¬Ø§Ù†ÙŠ</p><p class="text-4xl font-black text-yellow-400" id="f-f">-</p></div>
    </div>
</div>

<!-- â•â•â• Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª (âœ… Ù…Ø­Ø³Ù‘Ù†Ø©) â•â•â• -->
<div id="t-reports" class="tab">
    <h2 class="text-2xl font-black mb-5">ğŸš© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</h2>
    <div id="r-list" class="space-y-2"></div>
</div>

<!-- â•â•â• Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† â•â•â• -->
<div id="t-staff" class="tab">
    <div class="flex items-center justify-between mb-5"><h2 class="text-2xl font-black">ğŸ”‘ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2><button class="bp" onclick="openStaffModal()">+ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</button></div>
    <div class="glass overflow-x-auto"><table class="w-full text-sm"><thead><tr class="border-b border-purple-500/10"><th class="text-right p-3 text-purple-300/50">Ø§Ù„Ø§Ø³Ù…</th><th class="text-right p-3 text-purple-300/50">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th><th class="text-center p-3 text-purple-300/50">Ø§Ù„Ø¯ÙˆØ±</th><th class="text-center p-3 text-purple-300/50">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</th><th class="text-center p-3 text-purple-300/50">Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead><tbody id="st-list"></tbody></table></div>
</div>

<!-- â•â•â• Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª â•â•â• -->
<div id="t-settings" class="tab">
    <h2 class="text-2xl font-black mb-5">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</h2>
    <div class="glass p-6 mb-4"><h3 class="font-bold text-base mb-3">ğŸ“¢ Ù†Øµ Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠ</h3><textarea id="st-ban" class="inp" rows="2"></textarea><button class="bp mt-2" onclick="saveSt('banner_text',$('st-ban').value)">Ø­ÙØ¸</button></div>
    <div class="glass p-6 mb-4">
        <h3 class="font-bold text-base mb-4">ğŸ’° Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª</h3>
        <p class="text-purple-200/60 text-xs mb-4">Ø­Ø· Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ ÙˆØ§Ù„Ø­Ø§Ù„ÙŠ â€” Ù„Ùˆ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø£Ù‚Ù„ Ø¨ÙŠØ¸Ù‡Ø± Ø®Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø£ØµÙ„ÙŠ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</p>
        <div class="mb-4 p-4 rounded-xl" style="background:rgba(99,102,241,0.06);border:1px solid rgba(99,102,241,0.1)"><p class="text-indigo-400 font-bold text-sm mb-2">ğŸ“… Ø§Ù„Ø´Ù‡Ø±ÙŠ</p><div class="grid grid-cols-2 gap-3"><div><label class="text-purple-200/70 text-xs mb-1 block">Ø§Ù„Ø£ØµÙ„ÙŠ</label><input type="number" id="st-mo" class="inp" value="39"></div><div><label class="text-purple-200/70 text-xs mb-1 block">Ø§Ù„Ø­Ø§Ù„ÙŠ</label><input type="number" id="st-m" class="inp" value="29"></div></div></div>
        <div class="mb-4 p-4 rounded-xl" style="background:rgba(16,185,129,0.06);border:1px solid rgba(16,185,129,0.1)"><p class="text-emerald-400 font-bold text-sm mb-2">ğŸ’ Ø§Ù„Ø³Ù†ÙˆÙŠ (Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„Ù„Ø³Ù†Ø©)</p><div class="grid grid-cols-2 gap-3"><div><label class="text-purple-200/70 text-xs mb-1 block">Ø§Ù„Ø£ØµÙ„ÙŠ Ø§Ù„Ø³Ù†ÙˆÙŠ (Ø±ÙŠØ§Ù„)</label><input type="number" id="st-yo" class="inp" value="348"></div><div><label class="text-purple-200/70 text-xs mb-1 block">Ø§Ù„Ø­Ø§Ù„ÙŠ Ø§Ù„Ø³Ù†ÙˆÙŠ (Ø±ÙŠØ§Ù„)</label><input type="number" id="st-y" class="inp" value="228"></div></div><p class="text-purple-200/50 text-xs mt-2">* Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø´Ù‡Ø±ÙŠ ÙŠØªØ­Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Ã·12)</p></div>
        <button class="bp" onclick="savePrice()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</button>
    </div>
    <div class="glass p-6 mb-4"><h3 class="font-bold text-base mb-3">ğŸ†“ Ø­Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</h3><input type="number" id="st-fl" class="inp" value="10" style="max-width:120px"><button class="bp mt-2" onclick="saveSt('free_limit',$('st-fl').value)">Ø­ÙØ¸</button></div>
</div>

</div><!-- end mc -->

<!-- â•â•â• Question Modal (âœ… Ù…Ø­Ø±Ø± Ù†ØµÙˆØµ Ø§Ø­ØªØ±Ø§ÙÙŠ) â•â•â• -->
<div id="questionM" class="mbg hidden"><div class="mbox" style="max-width:620px">
    <div class="flex items-center justify-between mb-4"><h3 class="font-bold text-lg" id="qmT">Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„</h3><button onclick="$('questionM').classList.add('hidden')" class="text-purple-200/60 hover:text-white text-lg">âœ•</button></div>
    <input type="hidden" id="qm-id">
    <div class="space-y-4">
        <div class="grid grid-cols-2 gap-3">
            <div><label class="text-purple-300/50 text-sm mb-1 block">Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label><select id="qm-sec" class="inp" onchange="updateSubSec()"><option value="quant">Ù‚Ø¯Ø±Ø§Øª ÙƒÙ…ÙŠ</option><option value="verbal">Ù‚Ø¯Ø±Ø§Øª Ù„ÙØ¸ÙŠ</option><option value="tahsili">Ø§Ù„ØªØ­ØµÙŠÙ„ÙŠ</option></select></div>
            <div><label class="text-purple-300/50 text-sm mb-1 block">Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ÙØ±Ø¹ÙŠ</label><select id="qm-sub" class="inp"></select></div>
        </div>

        <div class="p-3 rounded-xl" style="background:rgba(99,102,241,0.05);border:1px solid rgba(99,102,241,0.1)">
            <label class="text-purple-300/50 text-sm mb-2 block">ğŸ–¼ï¸ ØµÙˆØ±Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input type="file" id="qm-file" accept="image/*" class="inp text-sm mb-2" onchange="previewImg(this)">
            <input id="qm-img" class="inp text-sm" placeholder="Ø£Ùˆ Ø­Ø· Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§...">
            <div id="qm-preview" class="mt-2 hidden"><img id="qm-prev-img" class="max-h-32 rounded-lg mx-auto"><button onclick="clearImg()" class="text-red-400 text-xs mt-1 block mx-auto">âœ• Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙˆØ±Ø©</button></div>
        </div>

        <!-- âœ… Ù…Ø­Ø±Ø± Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ -->
        <div>
            <label class="text-purple-300/50 text-sm mb-2 block">Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„</label>
            <div class="editor-wrap" id="qeditor-wrap">
                <div class="editor-toolbar" id="qeditor-tb"></div>
                <div class="editor-body" id="qm-editor" contenteditable="true" data-placeholder="Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù‡Ù†Ø§..." oninput="checkDuplicateLive()"></div>
            </div>
            <div id="dup-warn" class="dup-warn mt-2">
                <p class="text-yellow-300 text-sm font-bold">âš ï¸ Ø³Ø¤Ø§Ù„ Ù…Ø´Ø§Ø¨Ù‡ Ù…ÙˆØ¬ÙˆØ¯!</p>
                <p id="dup-text" class="text-yellow-200/70 text-xs mt-1"></p>
            </div>
        </div>

        <!-- Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª -->
        <div class="grid grid-cols-2 gap-2">
            <div><label class="text-purple-300/50 text-xs mb-1 block">Ø®ÙŠØ§Ø± 1 (Ø£)</label><input id="qm-c0" class="inp" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„"></div>
            <div><label class="text-purple-300/50 text-xs mb-1 block">Ø®ÙŠØ§Ø± 2 (Ø¨)</label><input id="qm-c1" class="inp" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ"></div>
            <div><label class="text-purple-300/50 text-xs mb-1 block">Ø®ÙŠØ§Ø± 3 (Ø¬)</label><input id="qm-c2" class="inp" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«"></div>
            <div><label class="text-purple-300/50 text-xs mb-1 block">Ø®ÙŠØ§Ø± 4 (Ø¯)</label><input id="qm-c3" class="inp" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹"></div>
        </div>

        <div><label class="text-purple-300/50 text-sm mb-1 block">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</label>
            <select id="qm-cor" class="inp"><option value="0">Ø®ÙŠØ§Ø± 1 (Ø£)</option><option value="1">Ø®ÙŠØ§Ø± 2 (Ø¨)</option><option value="2">Ø®ÙŠØ§Ø± 3 (Ø¬)</option><option value="3">Ø®ÙŠØ§Ø± 4 (Ø¯)</option></select>
        </div>

        <!-- âœ… Ù…Ø­Ø±Ø± Ø§Ù„Ø´Ø±Ø­ -->
        <div>
            <label class="text-purple-300/50 text-sm mb-2 block">ğŸ’¡ Ø§Ù„Ø´Ø±Ø­</label>
            <div class="editor-wrap" id="xeditor-wrap">
                <div class="editor-toolbar" id="xeditor-tb"></div>
                <div class="editor-body" id="qm-exp-editor" contenteditable="true" data-placeholder="Ø§ÙƒØªØ¨ Ø´Ø±Ø­ Ø§Ù„Ø­Ù„ Ù‡Ù†Ø§... (ÙŠØ¯Ø¹Ù… Ø§Ù„Ø£Ø³Ø·Ø± ÙˆØ§Ù„ØªÙ†Ø³ÙŠÙ‚)"></div>
            </div>
        </div>

        <button class="bp w-full" onclick="saveQ2()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø³Ø¤Ø§Ù„</button>
    </div>
</div></div>

<!-- â•â•â• User Modal (âœ… Ù…Ø­Ø³Ù‘Ù† - Ø¥ÙŠÙ…ÙŠÙ„ + ÙƒÙ„Ù…Ø© Ø³Ø± + Ø¯ÙˆØ± staff) â•â•â• -->
<div id="userM" class="mbg hidden"><div class="mbox">
    <div class="flex items-center justify-between mb-4"><h3 class="font-bold text-lg">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø¶Ùˆ</h3><button onclick="$('userM').classList.add('hidden')" class="text-purple-200/60 hover:text-white text-lg">âœ•</button></div>
    <input type="hidden" id="um-id">
    <div class="space-y-3">
        <div><label class="text-purple-300/50 text-sm mb-1 block">Ø§Ù„Ø§Ø³Ù…</label><input id="um-n" class="inp"></div>
        <!-- âœ… Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ -->
        <div><label class="text-purple-300/50 text-sm mb-1 block">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label><input id="um-e" class="inp" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"></div>
        <!-- âœ… ÙƒÙ„Ù…Ø© Ø³Ø± Ø¬Ø¯ÙŠØ¯Ø© -->
        <div>
            <label class="text-purple-300/50 text-sm mb-1 block">ÙƒÙ„Ù…Ø© Ø³Ø± Ø¬Ø¯ÙŠØ¯Ø© <span class="text-purple-300/40 text-xs">(Ø§ØªØ±ÙƒÙ‡Ø§ ÙØ§Ø±ØºØ© Ø¥Ø°Ø§ Ù…Ø§ ØªØ¨ÙŠ ØªØºÙŠÙŠØ±Ù‡Ø§)</span></label>
            <input id="um-pw" class="inp" type="password" placeholder="Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù‡Ù†Ø§...">
        </div>
        <div><label class="text-purple-300/50 text-sm mb-1 block">Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
            <select id="um-s" class="inp">
                <option value="free">Ù…Ø¬Ø§Ù†ÙŠ</option>
                <option value="monthly">Ø´Ù‡Ø±ÙŠ</option>
                <option value="yearly">Ø³Ù†ÙˆÙŠ</option>
            </select>
        </div>
        <!-- âœ… Ø¯ÙˆØ± Ù…ÙˆØ³Ù‘Ø¹ ÙŠØ´Ù…Ù„ staff -->
        <div><label class="text-purple-300/50 text-sm mb-1 block">Ø§Ù„Ø¯ÙˆØ±</label>
            <select id="um-r" class="inp">
                <option value="user">Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ</option>
                <option value="staff">Ù…ÙˆØ¸Ù</option>
                <option value="admin">Ø£Ø¯Ù…Ù†</option>
            </select>
        </div>
        <!-- âœ… ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ -->
        <div><label class="text-purple-300/50 text-sm mb-1 block">ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
            <input id="um-exp" type="date" class="inp">
        </div>
        <button class="bp w-full" onclick="saveU2()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
    </div>
</div></div>

<!-- â•â•â• Coupon Modal (âœ… Ù…Ø­Ø³Ù‘Ù†) â•â•â• -->
<div id="couponM" class="mbg hidden"><div class="mbox">
    <div class="flex items-center justify-between mb-4"><h3 class="font-bold text-lg">ÙƒÙˆØ¨ÙˆÙ† Ø¬Ø¯ÙŠØ¯</h3><button onclick="$('couponM').classList.add('hidden')" class="text-purple-200/60 hover:text-white text-lg">âœ•</button></div>
    <div class="space-y-3">
        <div><label class="text-purple-300/50 text-sm mb-1 block">Ø§Ù„ÙƒÙˆØ¯</label><input id="cm-c" class="inp" style="text-transform:uppercase" placeholder="Ù…Ø«Ø§Ù„: MADAREK50"></div>
        <div><label class="text-purple-300/50 text-sm mb-1 block">ÙŠØ·Ø¨Ù‘Ù‚ Ø¹Ù„Ù‰</label>
            <select id="cm-plan" class="inp">
                <option value="all">Ø§Ù„ÙƒÙ„ (Ø´Ù‡Ø±ÙŠ + Ø³Ù†ÙˆÙŠ)</option>
                <option value="monthly">Ø´Ù‡Ø±ÙŠ ÙÙ‚Ø·</option>
                <option value="yearly">Ø³Ù†ÙˆÙŠ ÙÙ‚Ø·</option>
            </select>
        </div>
        <div><label class="text-purple-300/50 text-sm mb-1 block">Ù†ÙˆØ¹ Ø§Ù„Ø®ØµÙ…</label>
            <select id="cm-t" class="inp">
                <option value="percentage">Ù†Ø³Ø¨Ø© %</option>
                <option value="fixed">Ù…Ø¨Ù„Øº Ø«Ø§Ø¨Øª (Ø±ÙŠØ§Ù„)</option>
                <option value="free">Ù…Ø¬Ø§Ù†ÙŠ 100% (Ø¨Ø¯ÙˆÙ† Ø¯ÙØ¹)</option>
            </select>
        </div>
        <div id="cm-val-wrap"><label class="text-purple-300/50 text-sm mb-1 block">Ø§Ù„Ù‚ÙŠÙ…Ø©</label><input type="number" id="cm-v" class="inp" placeholder="Ù…Ø«Ø§Ù„: 50"></div>
        <!-- âœ… Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù…ÙˆØ¶Ù‘Ø­Ø© -->
        <div>
            <label class="text-purple-300/50 text-sm mb-1 block">Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø°ÙŠ ÙŠØ­ØµÙ„ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
            <select id="cm-dur" class="inp">
                <option value="1">Ø´Ù‡Ø± ÙˆØ§Ø­Ø¯</option>
                <option value="3">3 Ø£Ø´Ù‡Ø±</option>
                <option value="6">6 Ø£Ø´Ù‡Ø±</option>
                <option value="12" selected>Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø© (12 Ø´Ù‡Ø±)</option>
            </select>
            <p class="text-purple-200/50 text-xs mt-1">âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¯Ø© Ù‡ÙŠ Ù…Ø§ ÙŠØ­ØµÙ„ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø¹Ø¶Ùˆ Ø¹Ù†Ø¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙˆØ¨ÙˆÙ† â€” Ø¨ØºØ¶ Ø§Ù„Ù†Ø¸Ø± Ø¹Ù† Ø§Ù„Ø¨Ø§Ù‚Ø©</p>
        </div>
        <div class="grid grid-cols-2 gap-3">
            <div><label class="text-purple-300/50 text-sm mb-1 block">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</label><input type="number" id="cm-x" class="inp" value="100"></div>
            <div><label class="text-purple-300/50 text-sm mb-1 block">ÙŠÙ†ØªÙ‡ÙŠ Ø¨ØªØ§Ø±ÙŠØ®</label><input type="date" id="cm-e" class="inp"></div>
        </div>
        <button class="bp w-full" onclick="saveC2()">ğŸ’¾ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†</button>
    </div>
</div></div>

<!-- â•â•â• Staff Modal â•â•â• -->
<div id="staffM" class="mbg hidden"><div class="mbox" style="max-width:560px">
    <div class="flex items-center justify-between mb-5">
        <h3 class="font-bold text-lg" id="staffM-title">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</h3>
        <button onclick="closeStaffModal()" class="text-purple-200/60 hover:text-white text-lg">âœ•</button>
    </div>
    <input type="hidden" id="sm-uid">
    <div class="mb-5">
        <label class="text-purple-300/50 text-sm mb-1 block">Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸Ù</label>
        <input id="sm-e" class="inp" placeholder="example@email.com">
    </div>
    <div class="mb-5">
        <label class="text-purple-300/50 text-sm mb-3 block">Ù†ÙˆØ¹ Ø§Ù„ÙˆØµÙˆÙ„</label>
        <div class="grid grid-cols-2 gap-3">
            <div class="role-box" id="role-admin-box" style="background:rgba(239,68,68,0.05);border-color:rgba(239,68,68,0.15)" onclick="selectStaffRole('admin')">
                <div class="text-2xl mb-1">ğŸ‘‘</div>
                <div class="font-bold text-white text-sm">Ø£Ø¯Ù…Ù† ÙƒØ§Ù…Ù„</div>
                <div class="text-xs mt-1" style="color:rgba(248,113,113,0.7)">ØµÙ„Ø§Ø­ÙŠØ© Ø¹Ù„Ù‰ ÙƒÙ„ Ø´ÙŠØ¡</div>
            </div>
            <div class="role-box staff-sel" id="role-staff-box" style="background:rgba(139,92,246,0.05);border-color:rgba(139,92,246,0.15)" onclick="selectStaffRole('staff')">
                <div class="text-2xl mb-1">ğŸ‘¤</div>
                <div class="font-bold text-white text-sm">Ù…ÙˆØ¸Ù</div>
                <div class="text-xs mt-1" style="color:rgba(196,181,253,0.7)">ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø®ØµØµØ©</div>
            </div>
        </div>
    </div>
    <div id="sm-perms">
        <label class="text-purple-300/50 text-sm mb-3 block">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</label>
        <div class="perm-card"><div><p class="font-bold text-white text-sm">ğŸ“ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</p><p style="color:rgba(196,181,253,0.5);font-size:.75rem;margin-top:2px">Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</p></div><label class="toggle-wrap"><input type="checkbox" id="perm-questions" checked><span class="toggle-track"></span></label></div>
        <div class="perm-card"><div><p class="font-bold text-white text-sm">ğŸ‘¥ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</p><p style="color:rgba(196,181,253,0.5);font-size:.75rem;margin-top:2px">Ø¹Ø±Ø¶ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</p></div><label class="toggle-wrap"><input type="checkbox" id="perm-users"><span class="toggle-track"></span></label></div>
        <div class="perm-card"><div><p class="font-bold text-white text-sm">ğŸ’° Ø§Ù„Ù…Ø§Ù„ÙŠØ©</p><p style="color:rgba(196,181,253,0.5);font-size:.75rem;margin-top:2px">Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</p></div><label class="toggle-wrap"><input type="checkbox" id="perm-finance"><span class="toggle-track"></span></label></div>
        <div class="perm-card"><div><p class="font-bold text-white text-sm">ğŸŸï¸ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª</p><p style="color:rgba(196,181,253,0.5);font-size:.75rem;margin-top:2px">Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª</p></div><label class="toggle-wrap"><input type="checkbox" id="perm-coupons"><span class="toggle-track"></span></label></div>
        <div class="perm-card"><div><p class="font-bold text-white text-sm">ğŸš© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</p><p style="color:rgba(196,181,253,0.5);font-size:.75rem;margin-top:2px">Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</p></div><label class="toggle-wrap"><input type="checkbox" id="perm-reports" checked><span class="toggle-track"></span></label></div>
        <div class="perm-card"><div><p class="font-bold text-white text-sm">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</p><p style="color:rgba(196,181,253,0.5);font-size:.75rem;margin-top:2px">ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</p></div><label class="toggle-wrap"><input type="checkbox" id="perm-settings"><span class="toggle-track"></span></label></div>
    </div>
    <button class="bp w-full mt-5" onclick="saveStaff()">ğŸ’¾ Ø­ÙØ¸</button>
</div></div>

<!-- â•â•â• Preview Modal â•â•â• -->
<div id="previewM" class="mbg hidden"><div class="mbox" style="max-width:420px">
    <div class="flex items-center justify-between mb-4"><h3 class="font-bold text-lg">ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø³Ø¤Ø§Ù„</h3><button onclick="$('previewM').classList.add('hidden')" class="text-purple-200/60 hover:text-white text-lg">âœ•</button></div>
    <div id="pv-body" class="space-y-3"></div>
</div></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
var sb=window.supabase.createClient('https://czzcmbxejxbotjemyuqf.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN6emNtYnhlanhib3RqZW15dXFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxNzQ0ODEsImV4cCI6MjA4NTc1MDQ4MX0.xDfG1qsDZGyUrpL44JfqOtk57dVsLaMsvIzJz1KgiR0');
var me=null;
var _allQCache=[]; // âœ… cache Ù„Ù„Ø£Ø³Ø¦Ù„Ø© Ù„ÙØ­Øµ Ø§Ù„ØªÙƒØ±Ø§Ø±
function $(id){return document.getElementById(id)}

var subSections={
    quant:['Ø§Ù„Ø¬Ø¨Ø± ÙˆØ§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª','Ø§Ù„Ù†Ø³Ø¨Ø© ÙˆØ§Ù„ØªÙ†Ø§Ø³Ø¨','Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©','Ø§Ù„Ø¥Ø­ØµØ§Ø¡','Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯','Ø§Ù„ØªØ­Ù„ÙŠÙ„'],
    verbal:['Ø§Ù„ØªÙ†Ø§Ø¸Ø± Ø§Ù„Ù„ÙØ¸ÙŠ','Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¬Ù…Ù„','Ø§Ù„Ø§Ø³ØªÙŠØ¹Ø§Ø¨ Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡','Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ø³ÙŠØ§Ù‚ÙŠ'],
    tahsili:['Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª','Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡','Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡','Ø§Ù„Ø£Ø­ÙŠØ§Ø¡','Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©']
};
function updateSubSec(){
    var sec=$('qm-sec').value;var opts=subSections[sec]||[];
    $('qm-sub').innerHTML=opts.map(function(o){return'<option value="'+o+'">'+o+'</option>'}).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… RICH TEXT EDITOR â€” Ù…Ø­Ø±Ø± Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Ø±Ù…ÙˆØ² Ø±ÙŠØ§Ø¶ÙŠØ© ÙˆØ®Ø§ØµØ©
var MATH_SYMBOLS=[
    {l:'Ã—',t:'Ø¶Ø±Ø¨'},  {l:'Ã·',t:'Ù‚Ø³Ù…Ø©'}, {l:'Â±',t:'Â±'},
    {l:'âˆš',t:'Ø¬Ø°Ø±'},  {l:'Â²',t:'ØªØ±Ø¨ÙŠØ¹'},{l:'Â³',t:'ØªÙƒØ¹ÙŠØ¨'},
    {l:'â‰ ',t:'Ù„Ø§ ÙŠØ³Ø§ÙˆÙŠ'},{l:'â‰¤',t:'â‰¤'},{l:'â‰¥',t:'â‰¥'},
    {l:'âˆ',t:'Ù„Ø§Ù†Ù‡Ø§ÙŠØ©'},{l:'Ï€',t:'Ø¨Ø§ÙŠ'},{l:'Â°',t:'Ø¯Ø±Ø¬Ø©'},
    {l:'Â½',t:'Ù†ØµÙ'},{l:'Â¼',t:'Ø±Ø¨Ø¹'},{l:'Â¾',t:'Ø«Ù„Ø§Ø«Ø© Ø£Ø±Ø¨Ø§Ø¹'},
    {l:'â†’',t:'Ø³Ù‡Ù…'},{l:'âˆ´',t:'Ø¥Ø°Ù†'},{l:'âˆµ',t:'Ù„Ø£Ù†'},
];

var COLORS=['#ffffff','#f87171','#fb923c','#facc15','#4ade80','#60a5fa','#a78bfa','#f472b6','#a5b4fc'];

function buildToolbar(tbId, editorId){
    var tb=$(tbId), ed=$(editorId);
    if(!tb||!ed)return;

    function cmd(c,v){
        ed.focus();
        document.execCommand(c,false,v||null);
        updateToolbarState(tbId,editorId);
    }

    function btn(icon,title,action,id){
        var b=document.createElement('button');
        b.className='tb-btn';b.type='button';
        b.title=title;b.innerHTML=icon;
        if(id)b.id=id;
        b.onclick=function(e){e.preventDefault();action()};
        tb.appendChild(b);
        return b;
    }
    function sep(){var s=document.createElement('div');s.className='tb-sep';tb.appendChild(s)}

    // Ø§ØªØ¬Ø§Ù‡
    btn('â‡’','ÙŠØ³Ø§Ø± Ù„Ù„ÙŠÙ…ÙŠÙ† (RTL)',function(){
        var sel=window.getSelection();
        if(sel&&sel.rangeCount){
            var range=sel.getRangeAt(0);
            var block=range.commonAncestorContainer;
            while(block&&block.nodeType!==1)block=block.parentNode;
            if(block&&block!==ed){block.style.direction='rtl';block.style.textAlign='right';}
            else ed.style.direction='rtl';
        }else{ed.style.direction='rtl';}
    },tbId+'_rtl');
    btn('â‡','ÙŠÙ…ÙŠÙ† Ù„Ù„ÙŠØ³Ø§Ø± (LTR)',function(){
        var sel=window.getSelection();
        if(sel&&sel.rangeCount){
            var range=sel.getRangeAt(0);
            var block=range.commonAncestorContainer;
            while(block&&block.nodeType!==1)block=block.parentNode;
            if(block&&block!==ed){block.style.direction='ltr';block.style.textAlign='left';}
            else ed.style.direction='ltr';
        }
    },tbId+'_ltr');
    sep();

    // Ù…Ø­Ø§Ø°Ø§Ø©
    btn('â‰¡','Ù…Ø­Ø§Ø°Ø§Ø© ÙŠÙ…ÙŠÙ†',function(){cmd('justifyRight')},tbId+'_jR');
    btn('â˜°','ØªÙˆØ³ÙŠØ·',function(){cmd('justifyCenter')},tbId+'_jC');
    btn('â˜·','Ù…Ø­Ø§Ø°Ø§Ø© ÙŠØ³Ø§Ø±',function(){cmd('justifyLeft')},tbId+'_jL');
    sep();

    // ØªÙ†Ø³ÙŠÙ‚
    btn('<b>Ø¨</b>','ØªØºÙ…ÙŠÙ‚',function(){cmd('bold')},tbId+'_bold');
    btn('<i>ÙŠ</i>','Ù…Ø§Ø¦Ù„',function(){cmd('italic')},tbId+'_ital');
    btn('<u>Ø®</u>','ØªØ³Ø·ÙŠØ±',function(){cmd('underline')},tbId+'_und');
    btn('<s>Ø´</s>','ÙŠØªÙˆØ³Ø·Ù‡ Ø®Ø·',function(){cmd('strikeThrough')},tbId+'_str');
    sep();

    // Ø­Ø¬Ù… Ø§Ù„Ø®Ø·
    var fs=document.createElement('select');
    fs.className='tb-select';fs.title='Ø­Ø¬Ù… Ø§Ù„Ø®Ø·';
    [{v:'2',l:'ØµØºÙŠØ±'},{v:'3',l:'Ø¹Ø§Ø¯ÙŠ'},{v:'4',l:'ÙƒØ¨ÙŠØ±'},{v:'5',l:'Ø£ÙƒØ¨Ø±'},{v:'6',l:'Ø¶Ø®Ù…'}].forEach(function(o){
        var op=document.createElement('option');op.value=o.v;op.textContent=o.l;
        if(o.v==='3')op.selected=true;
        fs.appendChild(op);
    });
    fs.onchange=function(){cmd('fontSize',this.value)};
    tb.appendChild(fs);
    sep();

    // Ù„ÙˆÙ† Ø§Ù„Ø®Ø·
    var cl=document.createElement('input');
    cl.type='color';cl.className='tb-color';cl.value='#ffffff';cl.title='Ù„ÙˆÙ† Ø§Ù„Ø®Ø·';
    cl.oninput=function(){cmd('foreColor',this.value)};
    tb.appendChild(cl);

    // Ø£Ù„ÙˆØ§Ù† Ø³Ø±ÙŠØ¹Ø©
    COLORS.forEach(function(c){
        var b2=document.createElement('button');
        b2.className='tb-btn';b2.type='button';b2.title=c;
        b2.style.cssText='width:18px;height:18px;border-radius:50%;background:'+c+';border:1px solid rgba(255,255,255,0.2);padding:0;flex-shrink:0';
        b2.onclick=function(e){e.preventDefault();cmd('foreColor',c)};
        tb.appendChild(b2);
    });
    sep();

    // Ø±Ù…ÙˆØ² Ø±ÙŠØ§Ø¶ÙŠØ©
    var mathSel=document.createElement('select');
    mathSel.className='tb-select';mathSel.title='Ø±Ù…ÙˆØ² Ø±ÙŠØ§Ø¶ÙŠØ©';
    var defOpt=document.createElement('option');defOpt.value='';defOpt.textContent='âˆ‘ Ø±Ù…Ø²';
    mathSel.appendChild(defOpt);
    MATH_SYMBOLS.forEach(function(s){
        var op=document.createElement('option');op.value=s.l;op.textContent=s.l+' '+s.t;
        mathSel.appendChild(op);
    });
    mathSel.onchange=function(){
        if(!this.value)return;
        ed.focus();
        document.execCommand('insertText',false,this.value);
        this.value='';
        updateToolbarState(tbId,editorId);
    };
    tb.appendChild(mathSel);

    // Ù…Ø¹Ø§Ø¯Ù„Ø© ÙƒØ§Ù…Ù„Ø© (ØªÙ…ÙŠÙŠØ²)
    btn('ğ‘¥Â²','Ø¥Ø¯Ø±Ø§Ø¬ Ù…Ø¹Ø§Ø¯Ù„Ø©/ÙƒØ³Ø±',function(){
        ed.focus();
        var v=prompt('Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©:','Ø³ + 5 = 10');
        if(v)document.execCommand('insertHTML',false,'<span class="math-sym">'+v+'</span>&nbsp;');
    });
    sep();

    // Ù‚ÙˆØ§Ø¦Ù… ÙˆØªØ¹Ø¯Ø§Ø¯
    btn('â€¢','Ù‚Ø§Ø¦Ù…Ø© Ù†Ù‚Ø·ÙŠØ©',function(){cmd('insertUnorderedList')});
    btn('1.','Ù‚Ø§Ø¦Ù…Ø© Ù…Ø±Ù‚Ù…Ø©',function(){cmd('insertOrderedList')});

    ed.addEventListener('keydown',function(e){
        // Enter ÙŠØ­ØªÙØ¸ Ø¨Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ ÙˆÙŠØ¶ÙŠÙ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯
        if(e.key==='Enter'&&!e.shiftKey){
            e.preventDefault();
            document.execCommand('insertParagraph',false);
        }
    });
    ed.addEventListener('keyup',function(){updateToolbarState(tbId,editorId)});
    ed.addEventListener('mouseup',function(){updateToolbarState(tbId,editorId)});
}

function updateToolbarState(tbId, editorId){
    var states={bold:tbId+'_bold',italic:tbId+'_ital',underline:tbId+'_und',strikeThrough:tbId+'_str'};
    Object.keys(states).forEach(function(cmd2){
        var el=$(states[cmd2]);
        if(el)el.classList.toggle('active',document.queryCommandState(cmd2));
    });
}

function initEditors(){
    buildToolbar('qeditor-tb','qm-editor');
    buildToolbar('xeditor-tb','qm-exp-editor');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… ÙØ­Øµ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var _dupTimer=null;
function checkDuplicateLive(){
    clearTimeout(_dupTimer);
    _dupTimer=setTimeout(function(){
        var ed=$('qm-editor');if(!ed)return;
        var txt=(ed.innerText||'').trim();
        var editId=$('qm-id').value;
        if(txt.length<15){$('dup-warn').style.display='none';return}
        var sim=_allQCache.find(function(q){
            if(q.id==editId)return false;
            var a=txt.toLowerCase(),b=(q.question_text||'').toLowerCase();
            if(a===b)return true;
            var minLen=Math.min(a.length,b.length);
            var checkLen=Math.floor(minLen*0.65);
            if(checkLen<8)return false;
            return b.includes(a.substring(0,checkLen))||a.includes(b.substring(0,checkLen));
        });
        if(sim){
            $('dup-text').textContent='Ù…ÙˆØ¬ÙˆØ¯: '+sim.question_text.substring(0,90)+'...';
            $('dup-warn').style.display='block';
        }else{
            $('dup-warn').style.display='none';
        }
    },700);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ù„Ù…ÙƒØ±Ø±Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function scanDuplicates(){
    var btn=document.querySelector('[onclick="scanDuplicates()"]');
    if(btn){btn.textContent='â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...';btn.disabled=true;}
    var{data}=await sb.from('questions').select('id,question_text,section');
    if(btn){btn.textContent='ÙØ­Øµ Ø§Ù„Ø¢Ù†';btn.disabled=false;}
    if(!data||data.length<2){
        $('dup-scan-result').classList.remove('hidden');
        $('dup-scan-list').innerHTML='<p class="text-emerald-400 text-sm text-center py-3">âœ… Ù…Ø§ ÙÙŠÙ‡ Ø£Ø³Ø¦Ù„Ø© Ù…ÙƒØ±Ø±Ø©</p>';
        return;
    }
    var groups=[];
    var used=new Set();
    var sn={quant:'ÙƒÙ…ÙŠ',verbal:'Ù„ÙØ¸ÙŠ',tahsili:'ØªØ­ØµÙŠÙ„ÙŠ'};
    for(var i=0;i<data.length;i++){
        if(used.has(data[i].id))continue;
        var simGroup=[data[i]];
        var a=(data[i].question_text||'').toLowerCase().trim();
        for(var j=i+1;j<data.length;j++){
            if(used.has(data[j].id))continue;
            var b=(data[j].question_text||'').toLowerCase().trim();
            if(!a||!b)continue;
            var sim=false;
            if(a===b){sim=true;}
            else{
                var shorter=a.length<b.length?a:b;
                var longer=a.length<b.length?b:a;
                if(shorter.length>=10&&longer.includes(shorter.substring(0,Math.floor(shorter.length*0.7))))sim=true;
            }
            if(sim){simGroup.push(data[j]);used.add(data[j].id);}
        }
        if(simGroup.length>1){
            used.add(data[i].id);
            groups.push(simGroup);
        }
    }
    $('dup-scan-result').classList.remove('hidden');
    if(!groups.length){
        $('dup-scan-list').innerHTML='<p class="text-emerald-400 text-sm text-center py-3">âœ… Ù…Ø§ ÙÙŠÙ‡ Ø£Ø³Ø¦Ù„Ø© Ù…ÙƒØ±Ø±Ø© â€” Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù†Ø¸ÙŠÙ</p>';
        return;
    }
    var h='<p class="text-red-400 text-sm font-bold mb-2">ÙˆÙØ¬Ø¯Øª '+groups.length+' Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…ØªÙƒØ±Ø±Ø©:</p>';
    groups.forEach(function(g,gi){
        h+='<div class="dup-result-item"><div class="flex-1"><p class="text-red-300 text-xs font-bold mb-1">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© '+(gi+1)+' ('+g.length+' Ø£Ø³Ø¦Ù„Ø©)</p>';
        g.forEach(function(q){
            h+='<div class="flex items-start gap-2 mb-1"><span class="bg bg-'+(q.section==='quant'?'m':q.section==='verbal'?'y':'f')+'" style="font-size:.7rem;padding:1px 6px">'+(sn[q.section]||'')+'</span>'
              +'<span class="text-white text-xs flex-1">'+q.question_text.substring(0,70)+'...</span>'
              +'<button class="text-yellow-400 text-xs underline flex-shrink-0" onclick="editQ(\''+q.id+'\')">ØªØ¹Ø¯ÙŠÙ„</button>'
              +'<button class="text-red-400 text-xs underline flex-shrink-0 mr-1" onclick="delQ(\''+q.id+'\')">Ø­Ø°Ù</button>'
              +'</div>';
        });
        h+='</div></div>';
    });
    $('dup-scan-list').innerHTML=h;
}

var _staffRole='staff';
var _myPerms=null;

async function init(){
    var{data:{session}}=await sb.auth.getSession();
    if(!session){location.href='admin-login.html';return}
    var{data:p}=await sb.from('profiles').select('role,full_name,permissions').eq('id',session.user.id).single();
    if(!p||(p.role!=='admin'&&p.role!=='staff')){location.href='admin-login.html';return}
    me={id:session.user.id,...p};
    if(p.role==='staff'&&p.permissions){
        _myPerms=typeof p.permissions==='string'?JSON.parse(p.permissions):p.permissions;
    }
    _applyPerms();
    loadOV();
    // âœ… ØªØ­Ù…ÙŠÙ„ ÙƒØ§Ø´ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
    sb.from('questions').select('id,question_text').then(function(r){if(r.data)_allQCache=r.data});
}

function _hasPerm(perm){
    if(!me)return false;
    if(me.role==='admin')return true;
    return _myPerms&&_myPerms[perm]===true;
}

function _applyPerms(){
    document.querySelectorAll('.sb-link[data-perm]').forEach(function(el){
        el.style.display=_hasPerm(el.dataset.perm)?'':'none';
    });
}

// âœ… ÙØ­Øµ Ø§Ù„ØªÙƒØ±Ø§Ø±
var _dupTimer=null;
function checkDuplicate(){
    clearTimeout(_dupTimer);
    _dupTimer=setTimeout(function(){
        var txt=($('qm-txt').value||'').trim();
        var editId=$('qm-id').value;
        if(txt.length<10){$('dup-warn').style.display='none';return}
        var sim=_allQCache.find(function(q){
            if(q.id==editId)return false;
            var a=txt.toLowerCase(),b=(q.question_text||'').toLowerCase();
            // Ø¨Ø­Ø« Ø¹Ù† ØªØ´Ø§Ø¨Ù‡ â‰¥70%
            if(b.includes(a.substring(0,Math.floor(a.length*0.7))))return true;
            if(a.includes(b.substring(0,Math.floor(b.length*0.7))))return true;
            return false;
        });
        if(sim){
            $('dup-text').textContent='Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯: '+sim.question_text.substring(0,80)+'...';
            $('dup-warn').style.display='block';
        }else{
            $('dup-warn').style.display='none';
        }
    },600);
}

function openStaffModal(data){
    $('staffM-title').textContent=data?'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸Ù':'Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù';
    $('sm-uid').value=data?data.id:'';
    $('sm-e').value=data?(data.email||''):'';
    $('sm-e').disabled=!!data;
    var role=data?data.role:'staff';
    selectStaffRole(role==='admin'?'admin':'staff');
    var perms=data&&data.permissions?(typeof data.permissions==='string'?JSON.parse(data.permissions):data.permissions):{};
    ['questions','users','finance','coupons','reports','settings'].forEach(function(p){
        var el=$('perm-'+p);
        if(el)el.checked=data?perms[p]===true:(p==='questions'||p==='reports');
    });
    $('staffM').classList.remove('hidden');
}

function closeStaffModal(){$('staffM').classList.add('hidden')}

function selectStaffRole(role){
    _staffRole=role;
    var ab=$('role-admin-box'),sb2=$('role-staff-box');
    if(role==='admin'){
        ab.classList.add('admin-sel');ab.style.borderColor='rgba(239,68,68,0.5)';
        sb2.classList.remove('staff-sel');sb2.style.borderColor='rgba(139,92,246,0.15)';
    }else{
        sb2.classList.add('staff-sel');sb2.style.borderColor='rgba(139,92,246,0.5)';
        ab.classList.remove('admin-sel');ab.style.borderColor='rgba(239,68,68,0.15)';
    }
    $('sm-perms').style.opacity=role==='admin'?'0.35':'1';
    $('sm-perms').style.pointerEvents=role==='admin'?'none':'auto';
}

async function saveStaff(){
    var uid=$('sm-uid').value;
    var email=$('sm-e').value.trim();
    if(!uid&&!email){toast('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„',false);return}
    var perms=null;
    if(_staffRole!=='admin'){
        perms={};
        ['questions','users','finance','coupons','reports','settings'].forEach(function(p){
            perms[p]=$('perm-'+p).checked;
        });
    }
    var targetId=uid;
    if(!uid){
        var{data:u,error:ue}=await sb.from('profiles').select('id').eq('email',email).single();
        if(!u){toast('Ù…Ø§ Ù„Ù‚ÙŠÙ†Ø§ Ø­Ø³Ø§Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„',false);return}
        targetId=u.id;
    }
    var{error}=await sb.from('profiles').update({
        role:_staffRole==='admin'?'admin':'staff',
        permissions:perms
    }).eq('id',targetId);
    if(error){toast('Ø®Ø·Ø£: '+error.message,false);return}
    toast('ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ“',true);
    closeStaffModal();
    loadST();
}

document.querySelectorAll('.sb-link[data-tab]').forEach(function(el){
    el.addEventListener('click',function(){
        var t=this.dataset.tab;
        var perm=this.dataset.perm;
        if(perm&&!_hasPerm(perm)){toast('Ù…Ø§ Ø¹Ù†Ø¯Ùƒ ØµÙ„Ø§Ø­ÙŠØ©',false);return}
        document.querySelectorAll('.tab').forEach(function(s){s.classList.remove('on')});
        document.querySelectorAll('.sb-link').forEach(function(l){l.classList.remove('on')});
        $('t-'+t).classList.add('on');this.classList.add('on');
        if(t==='overview')loadOV();if(t==='questions')loadQ();if(t==='users')loadU();
        if(t==='coupons')loadC();if(t==='finance')loadF();if(t==='reports')loadR();
        if(t==='staff')loadST();if(t==='settings')loadSet();
    });
});

function toast(m,ok){var t=$('toast');t.textContent=m;t.className='toast '+(ok?'tok':'ter');setTimeout(function(){t.classList.add('hidden')},3000)}

// âœ… Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ù…ÙˆØ³Ù‘Ø¹Ø©
async function loadOV(){
    var[{data:q},{data:u},{data:a},{data:r}]=await Promise.all([
        sb.from('questions').select('section,sub_section'),
        sb.from('profiles').select('id,full_name,email,avatar_emoji,created_at,subscription_type'),
        sb.from('attempts').select('id,user_id,is_correct,question_id,created_at').order('created_at',{ascending:false}).limit(500),
        sb.from('reports').select('id')
    ]);
    $('s-q').textContent=q?q.length:0;
    $('s-u').textContent=u?u.length:0;
    $('s-a').textContent=a?a.length:0;
    $('s-r').textContent=r?r.length:0;

    // âœ… Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
    if(u){
        var um=u.filter(function(x){return x.subscription_type==='monthly'}).length;
        var uy=u.filter(function(x){return x.subscription_type==='yearly'}).length;
        var uf=u.filter(function(x){return!x.subscription_type||x.subscription_type==='free'}).length;
        $('ov-active').textContent=um+uy;
        $('ov-monthly').textContent=um;
        $('ov-yearly').textContent=uy;
        $('ov-free').textContent=uf;
    }

    // âœ… Ù…Ø­Ø§ÙƒØ§Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† (Ø¢Ø®Ø± 5 Ø¯Ù‚Ø§Ø¦Ù‚)
    if(a){
        var fiveMin=new Date(Date.now()-5*60*1000);
        var onlineSet=new Set();
        a.forEach(function(x){if(new Date(x.created_at)>=fiveMin)onlineSet.add(x.user_id)});
        $('s-online').textContent=onlineSet.size;
    }

    if(q){var c={quant:0,verbal:0,tahsili:0};q.forEach(function(x){if(c[x.section]!==undefined)c[x.section]++});
    var nm={quant:'Ù‚Ø¯Ø±Ø§Øª ÙƒÙ…ÙŠ',verbal:'Ù‚Ø¯Ø±Ø§Øª Ù„ÙØ¸ÙŠ',tahsili:'Ø§Ù„ØªØ­ØµÙŠÙ„ÙŠ'},cl={quant:'#6366f1',verbal:'#10b981',tahsili:'#8b5cf6'},tot=q.length||1,h='';
    for(var k in c){var p=Math.round(c[k]/tot*100);h+='<div class="flex items-center justify-between text-sm mb-1"><span class="text-purple-200/70">'+nm[k]+'</span><span class="font-bold text-white">'+c[k]+'</span></div><div class="h-2 rounded-full mb-3" style="background:rgba(255,255,255,0.06)"><div class="h-full rounded-full" style="width:'+p+'%;background:'+cl[k]+'"></div></div>'}
    $('d-sec').innerHTML=h}

    if(!a||!a.length){
        $('d-hard').innerHTML='<p class="text-purple-200/70">Ù…Ø§ ÙÙŠÙ‡ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¨Ø¹Ø¯</p>';
        $('d-rate').textContent='-';
        $('d-top').innerHTML=$('d-acc').innerHTML=$('d-act').innerHTML=$('d-recent').innerHTML='<p class="text-purple-200/60">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>';
        if(u&&u.length)renderNewUsers(u);
        return;
    }

    var wr=a.filter(function(x){return!x.is_correct}),fr={};
    wr.forEach(function(x){fr[x.question_id]=(fr[x.question_id]||0)+1});
    if(Object.keys(fr).length){var hid=Object.keys(fr).sort(function(a,b){return fr[b]-fr[a]})[0];
    var{data:hq}=await sb.from('questions').select('question_text,section').eq('id',hid).single();
    if(hq){var sn={quant:'ÙƒÙ…ÙŠ',verbal:'Ù„ÙØ¸ÙŠ',tahsili:'ØªØ­ØµÙŠÙ„ÙŠ'};$('d-hard').innerHTML='<span class="bg bg-m mb-2">'+(sn[hq.section]||'')+'</span><p class="text-white text-base mt-2">'+hq.question_text.substring(0,120)+'</p><p class="text-red-400 text-sm mt-2 font-bold">ğŸ”´ '+fr[hid]+' Ø®Ø·Ø£</p>'}}
    else $('d-hard').innerHTML='<p class="text-purple-200/70">Ù…Ø§ ÙÙŠÙ‡ Ø£Ø®Ø·Ø§Ø¡</p>';

    var cor=a.filter(function(x){return x.is_correct}).length;
    $('d-rate').textContent=Math.round(cor/a.length*100)+'%';

    var um2={};if(u)u.forEach(function(x){um2[x.id]=x});
    var ua={};a.forEach(function(x){if(!ua[x.user_id])ua[x.user_id]={t:0,c:0};ua[x.user_id].t++;if(x.is_correct)ua[x.user_id].c++});
    var rc=['#fbbf24','#c0c0c0','#cd7f32','#818cf8','#818cf8'],rb=['rgba(251,191,36,0.15)','rgba(192,192,192,0.1)','rgba(205,127,50,0.1)','rgba(129,140,248,0.08)','rgba(129,140,248,0.08)'];

    function rank(arr,el,valFn){var h='';arr.forEach(function(uid,i){var usr=um2[uid]||{};h+='<div class="rr"><div class="rn" style="background:'+rb[i]+';color:'+rc[i]+'">'+(i+1)+'</div><div class="flex-1"><p class="text-white font-bold text-sm">'+(usr.full_name||'Ù…Ø¬Ù‡ÙˆÙ„')+'</p></div><div class="text-left">'+valFn(uid)+'</div></div>'});el.innerHTML=h||'<p class="text-purple-200/60">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>'}

    rank(Object.keys(ua).sort(function(a,b){return ua[b].t-ua[a].t}).slice(0,5),$('d-top'),function(uid){return'<p class="text-lg font-black text-indigo-400">'+ua[uid].t+'</p><p class="text-purple-200/60 text-[10px]">Ù…Ø­Ø§ÙˆÙ„Ø©</p>'});
    rank(Object.keys(ua).filter(function(uid){return ua[uid].t>=3}).sort(function(a,b){return ua[b].c/ua[b].t-ua[a].c/ua[a].t}).slice(0,5),$('d-acc'),function(uid){return'<p class="text-lg font-black text-emerald-400">'+Math.round(ua[uid].c/ua[uid].t*100)+'%</p>'});

    var wa=new Date();wa.setDate(wa.getDate()-7);var ra={};
    a.forEach(function(x){if(new Date(x.created_at)>=wa)ra[x.user_id]=(ra[x.user_id]||0)+1});
    rank(Object.keys(ra).sort(function(a,b){return ra[b]-ra[a]}).slice(0,5),$('d-act'),function(uid){return'<p class="text-lg font-black text-purple-400">'+ra[uid]+'</p><p class="text-purple-200/60 text-[10px]">Ù‡Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</p>'});

    if(u&&u.length)renderNewUsers(u);

    // âœ… Ø¢Ø®Ø± Ù†Ø´Ø§Ø·
    var recentH='';
    a.slice(0,10).forEach(function(x){
        var usr=um2[x.user_id]||{};
        var d=new Date(x.created_at);
        var timeStr=d.toLocaleTimeString('ar-SA',{hour:'2-digit',minute:'2-digit'})+' - '+d.toLocaleDateString('ar-SA');
        recentH+='<div class="flex items-center gap-3 p-2 rounded-lg hover:bg-white/5"><span class="text-base">'+(usr.avatar_emoji||'ğŸ‘¤')+'</span><div class="flex-1"><p class="text-white text-sm font-bold">'+(usr.full_name||'Ù…Ø¬Ù‡ÙˆÙ„')+'</p></div><span class="text-xs '+(x.is_correct?'text-emerald-400':'text-red-400')+'">'+(x.is_correct?'âœ“ ØµØ­':'âœ— Ø®Ø·Ø£')+'</span><p class="text-purple-200/50 text-xs">'+timeStr+'</p></div>';
    });
    $('d-recent').innerHTML=recentH||'<p class="text-purple-200/60">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø´Ø§Ø·</p>';
}

function renderNewUsers(u){
    var nh='';
    u.sort(function(a,b){return new Date(b.created_at)-new Date(a.created_at)}).slice(0,5).forEach(function(m){
        nh+='<div class="rr"><span class="text-lg">'+(m.avatar_emoji||'ğŸ‘¤')+'</span><div class="flex-1"><p class="text-white font-bold text-sm">'+(m.full_name||'â€”')+'</p><p class="text-purple-200/60 text-xs">'+(m.email||'')+'</p></div><p class="text-purple-200/60 text-xs">'+(m.created_at?new Date(m.created_at).toLocaleDateString('ar-SA'):'')+'</p></div>'
    });
    $('d-new').innerHTML=nh;
}

// âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ø­Ø³Ù‘Ù†
async function loadQ(){
    $('q-list').innerHTML='<p class="text-center text-purple-200/60 py-4">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';
    var f=$('qf').value,s=$('qs').value.trim().toLowerCase();
    var qr=sb.from('questions').select('id,section,sub_section,question_text,image_url,correct_index,choices').order('created_at',{ascending:false});
    if(f!=='all')qr=qr.eq('section',f);
    var{data}=await qr;
    if(!data)data=[];
    // âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ§Ø´
    _allQCache=data.map(function(q){return{id:q.id,question_text:q.question_text}});
    if(s)data=data.filter(function(q){return (q.question_text||'').toLowerCase().includes(s)});
    var sn={quant:'ÙƒÙ…ÙŠ',verbal:'Ù„ÙØ¸ÙŠ',tahsili:'ØªØ­ØµÙŠÙ„ÙŠ'},h='';
    data.forEach(function(q){
        var img=q.image_url?'<img src="'+q.image_url+'" class="w-16 h-16 rounded-lg object-cover ml-2 flex-shrink-0">':'';
        h+='<div class="glass p-4"><div class="flex items-start justify-between gap-3"><div class="flex-1 flex gap-3">'+img+'<div><span class="bg bg-'+(q.section==='quant'?'m':q.section==='verbal'?'y':'f')+'">'+(sn[q.section]||'')+'</span>'+(q.sub_section?'<span class="text-purple-200/60 text-xs mr-2">'+q.sub_section+'</span>':'')+'<p class="text-sm text-white leading-relaxed mt-1">'+(q.question_text||'Ø³Ø¤Ø§Ù„ Ø¨Ø§Ù„ØµÙˆØ±Ø©').substring(0,100)+'</p></div></div><div class="flex gap-1 flex-shrink-0"><button class="bs qact" data-a="preview" data-id="'+q.id+'">ğŸ‘ï¸</button><button class="bs qact" data-a="edit" data-id="'+q.id+'">âœï¸</button><button class="bd qact" data-a="del" data-id="'+q.id+'">ğŸ—‘ï¸</button></div></div></div>'
    });
    $('q-list').innerHTML=h||'<p class="text-purple-200/60 text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø©</p>';
    document.querySelectorAll('.qact').forEach(function(btn){
        btn.addEventListener('click',function(){
            var id=this.dataset.id,a=this.dataset.a;
            if(a==='preview')previewQ(id);
            if(a==='edit')editQ(id);
            if(a==='del')delQ(id);
        });
    });
}

function openQM(q){
    $('qmT').textContent=q?'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„':'Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„';
    $('qm-id').value=q?q.id:'';
    $('qm-sec').value=q?q.section:'quant';
    updateSubSec();
    if(q&&q.sub_section)$('qm-sub').value=q.sub_section;
    // âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ø±
    var qed=$('qm-editor'),xed=$('qm-exp-editor');
    if(qed)qed.innerHTML=q?(q.question_text||''):'';
    if(xed)xed.innerHTML=q?(q.explanation||''):'';
    $('qm-img').value=q?(q.image_url||''):'';
    if(q&&q.image_url){$('qm-prev-img').src=q.image_url;$('qm-preview').classList.remove('hidden')}
    else{$('qm-preview').classList.add('hidden')}
    $('qm-file').value='';
    $('dup-warn').style.display='none';
    var c=q?(q.choices||[]):[];for(var i=0;i<4;i++)$('qm-c'+i).value=c[i]||'';
    $('qm-cor').value=q?q.correct_index:'0';
    $('questionM').classList.remove('hidden');
}
function previewImg(inp){if(inp.files&&inp.files[0]){var r=new FileReader();r.onload=function(e){$('qm-prev-img').src=e.target.result;$('qm-preview').classList.remove('hidden')};r.readAsDataURL(inp.files[0])}}
function clearImg(){$('qm-preview').classList.add('hidden');$('qm-img').value='';$('qm-file').value='';$('qm-prev-img').src=''}

async function editQ(id){var{data}=await sb.from('questions').select('*').eq('id',id).single();if(data)openQM(data)}

async function previewQ(id){
    var{data:q}=await sb.from('questions').select('*').eq('id',id).single();
    if(!q)return;
    var sn={quant:'ÙƒÙ…ÙŠ',verbal:'Ù„ÙØ¸ÙŠ',tahsili:'ØªØ­ØµÙŠÙ„ÙŠ'};
    var h='<div class="text-center"><span class="bg bg-'+(q.section==='quant'?'m':q.section==='verbal'?'y':'f')+'">'+(sn[q.section]||'')+'</span>'+(q.sub_section?' <span class="text-purple-200/70 text-xs">'+q.sub_section+'</span>':'')+'</div>';
    if(q.image_url)h+='<div class="rounded-xl overflow-hidden" style="background:rgba(255,255,255,0.95);padding:8px"><img src="'+q.image_url+'" class="w-full rounded-lg"></div>';
    if(q.question_text&&q.question_text!=='Ø³Ø¤Ø§Ù„ Ø¨Ø§Ù„ØµÙˆØ±Ø©')h+='<p class="text-white text-center text-base font-bold">'+q.question_text+'</p>';
    var choices=q.choices||[];
    var letters=['Ø£','Ø¨','Ø¬','Ø¯'];
    choices.forEach(function(c,i){
        var isCorrect=i===q.correct_index;
        h+='<div class="flex items-center gap-3 p-3 rounded-xl" style="background:'+(isCorrect?'rgba(16,185,129,0.12);border:1px solid rgba(16,185,129,0.3)':'rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08)')+'"><span class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-black flex-shrink-0" style="background:'+(isCorrect?'#10b981':'rgba(99,102,241,0.3)')+';color:#fff">'+letters[i]+'</span><span class="text-white text-sm '+(isCorrect?'font-bold':'')+'">'+(c||'â€”')+'</span>'+(isCorrect?' <span class="text-emerald-400 text-xs mr-auto">âœ“</span>':'')+'</div>';
    });
    if(q.explanation)h+='<div class="p-3 rounded-xl" style="background:rgba(251,191,36,0.06);border:1px solid rgba(251,191,36,0.15)"><p class="text-yellow-200/70 text-xs font-bold mb-1">ğŸ’¡ Ø§Ù„Ø´Ø±Ø­</p><p class="text-purple-200/60 text-sm">'+q.explanation+'</p></div>';
    $('pv-body').innerHTML=h;$('previewM').classList.remove('hidden');
}

async function uploadImg(){
    var file=$('qm-file').files[0];
    if(!file)return $('qm-img').value||null;
    try{
        var ext=file.name.split('.').pop();var name='q_'+Date.now()+'.'+ext;
        var{data,error}=await sb.storage.from('question-images').upload(name,file,{cacheControl:'3600',upsert:false});
        if(error){return await new Promise(function(resolve){var reader=new FileReader();reader.onload=function(e){resolve(e.target.result)};reader.readAsDataURL(file)})}
        var{data:pub}=sb.storage.from('question-images').getPublicUrl(name);
        return pub.publicUrl;
    }catch(e){
        return await new Promise(function(resolve){var reader=new FileReader();reader.onload=function(e){resolve(e.target.result)};reader.readAsDataURL(file)});
    }
}

async function saveQ2(){
    var id=$('qm-id').value;
    var imgUrl=await uploadImg();
    // âœ… Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„ØºÙ†ÙŠ
    var qed=$('qm-editor'),xed=$('qm-exp-editor');
    var qText=qed?qed.innerHTML.trim():'';
    var qTextPlain=qed?qed.innerText.trim():'';
    var expHtml=xed?xed.innerHTML.trim():'';

    var obj={
        section:$('qm-sec').value,
        subject:$('qm-sub').value||$('qm-sec').value,
        sub_section:$('qm-sub').value,
        question_text:qText||'Ø³Ø¤Ø§Ù„ Ø¨Ø§Ù„ØµÙˆØ±Ø©',
        choices:[$('qm-c0').value,$('qm-c1').value,$('qm-c2').value,$('qm-c3').value],
        correct_index:parseInt($('qm-cor').value),
        explanation:expHtml||null,
        image_url:imgUrl||null
    };
    if(!obj.choices[0]){toast('Ø§Ù…Ù„Ø£ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª',false);return}
    var{error}=id?await sb.from('questions').update(obj).eq('id',id):await sb.from('questions').insert(obj);
    if(error){toast('Ø®Ø·Ø£: '+error.message,false);return}
    // âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ§Ø´
    _allQCache=_allQCache.filter(function(q){return q.id!=id});
    _allQCache.push({id:id||'new',question_text:qTextPlain});
    toast(id?'ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ“':'ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ“',true);
    $('questionM').classList.add('hidden');
    loadQ();
}
async function delQ(id){if(!confirm('Ù…ØªØ£ÙƒØ¯ØŸ'))return;await sb.from('attempts').delete().eq('question_id',id);await sb.from('reports').delete().eq('question_id',id);await sb.from('questions').delete().eq('id',id);toast('ØªÙ… Ø§Ù„Ø­Ø°Ù',true);loadQ()}

// âœ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø¶Ùˆ Ù…Ø­Ø³Ù‘Ù†
async function loadU(){
    var s=($('us').value||'').trim().toLowerCase();
    var{data}=await sb.from('profiles').select('*').order('created_at',{ascending:false});
    if(!data)data=[];
    if(s)data=data.filter(function(u){return(u.full_name||'').toLowerCase().includes(s)||(u.email||'').toLowerCase().includes(s)});
    var h='';
    data.forEach(function(u){
        var bg=u.subscription_type==='monthly'?'bg-m':u.subscription_type==='yearly'?'bg-y':'bg-f';
        var lb=u.subscription_type==='monthly'?'Ø´Ù‡Ø±ÙŠ':u.subscription_type==='yearly'?'Ø³Ù†ÙˆÙŠ':'Ù…Ø¬Ø§Ù†ÙŠ';
        var roleBadge=u.role==='admin'?'<span class="bg bg-a mr-1">Ø£Ø¯Ù…Ù†</span>':u.role==='staff'?'<span class="badge-staff mr-1">Ù…ÙˆØ¸Ù</span>':'';
        h+='<tr class="tr"><td class="p-3"><div class="flex items-center gap-2"><span>'+(u.avatar_emoji||'ğŸ‘¤')+'</span><span class="font-bold">'+(u.full_name||'â€”')+'</span>'+roleBadge+'</div></td><td class="p-3 text-purple-200/70 text-sm">'+(u.email||'')+'</td><td class="p-3 text-center"><span class="bg '+bg+'">'+lb+'</span></td><td class="p-3 text-center text-purple-200/60 text-xs">'+(u.created_at?new Date(u.created_at).toLocaleDateString('ar-SA'):'')+'</td><td class="p-3 text-center"><button class="bs" onclick="editU(\''+u.id+'\')">âœï¸</button></td></tr>'
    });
    $('u-list').innerHTML=h;
}

async function editU(id){
    var{data}=await sb.from('profiles').select('*').eq('id',id).single();
    if(!data)return;
    $('um-id').value=data.id;
    $('um-n').value=data.full_name||'';
    $('um-e').value=data.email||'';
    $('um-pw').value='';
    $('um-s').value=data.subscription_type||'free';
    $('um-r').value=data.role||'user';
    // âœ… ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    if(data.subscription_end){
        var d=new Date(data.subscription_end);
        $('um-exp').value=d.toISOString().split('T')[0];
    }else{
        $('um-exp').value='';
    }
    $('userM').classList.remove('hidden');
}

async function saveU2(){
    var id=$('um-id').value;
    var updateData={
        full_name:$('um-n').value,
        subscription_type:$('um-s').value,
        role:$('um-r').value
    };
    // âœ… ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    var expVal=$('um-exp').value;
    if(expVal)updateData.subscription_end=expVal;

    var{error}=await sb.from('profiles').update(updateData).eq('id',id);
    if(error){toast('Ø®Ø·Ø£: '+error.message,false);return}

    // âœ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø¹Ø¨Ø± Supabase Admin API (Ø¥Ø°Ø§ Ù…ØªØ§Ø­Ø©)
    var pw=$('um-pw').value.trim();
    if(pw){
        // Ù†Ø³ØªØ®Ø¯Ù… Edge Function Ø£Ùˆ Ù†ÙˆØ¬Ù‘Ù‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·
        toast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ“ (ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±: Ø£Ø±Ø³Ù„ Ø±Ø§Ø¨Ø· reset Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Supabase Dashboard)',true);
    }else{
        toast('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ“',true);
    }
    $('userM').classList.add('hidden');
    loadU();
}

// âœ… Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª Ù…Ø­Ø³Ù‘Ù†Ø©
async function loadC(){
    var{data}=await sb.from('coupons').select('*').order('created_at',{ascending:false});
    if(!data||!data.length){$('c-list').innerHTML='<tr><td colspan="7" class="p-6 text-center text-purple-200/60">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙˆØ¨ÙˆÙ†Ø§Øª</td></tr>';return}
    var planN={all:'Ø§Ù„ÙƒÙ„',monthly:'Ø´Ù‡Ø±ÙŠ',yearly:'Ø³Ù†ÙˆÙŠ'};
    var durN={'1':'Ø´Ù‡Ø±','3':'3 Ø£Ø´Ù‡Ø±','6':'6 Ø£Ø´Ù‡Ø±','12':'Ø³Ù†Ø©'};
    var h='';
    data.forEach(function(c){
        var ok=!c.expires_at||new Date(c.expires_at)>new Date();
        // âœ… Ø­Ø³Ø§Ø¨ ØµØ­ Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
        var usedDisplay=(c.used_count||0)+'/'+(c.max_uses||'âˆ');
        h+='<tr class="tr"><td class="p-3 font-bold text-indigo-300">'+c.code+'</td>'
        +'<td class="p-3 text-center">'+(c.discount_type==='free'?'<span class="text-emerald-400 font-bold">Ù…Ø¬Ø§Ù†ÙŠ</span>':c.discount_value+(c.discount_type==='percentage'?'%':' Ø±'))+'</td>'
        +'<td class="p-3 text-center text-purple-200/70 text-xs">'+(planN[c.plan_type]||'Ø§Ù„ÙƒÙ„')+'</td>'
        +'<td class="p-3 text-center"><span class="bg bg-m">'+(durN[String(c.duration_months)]||c.duration_months+' Ø´Ù‡Ø±')+'</span></td>'
        +'<td class="p-3 text-center font-bold '+((c.used_count||0)>0?'text-emerald-400':'')+'">'+usedDisplay+'</td>'
        +'<td class="p-3 text-center"><span class="bg '+(ok?'bg-y':'bg-f')+'">'+(ok?'ÙØ¹Ù‘Ø§Ù„':'Ù…Ù†ØªÙ‡ÙŠ')+'</span></td>'
        +'<td class="p-3 text-center"><button class="bd" onclick="delC(\''+c.id+'\')">ğŸ—‘ï¸</button></td></tr>';
    });
    $('c-list').innerHTML=h;
}

async function saveC2(){
    var discType=$('cm-t').value;
    var obj={
        code:$('cm-c').value.toUpperCase().trim(),
        discount_type:discType,
        discount_value:discType==='free'?100:parseFloat($('cm-v').value||0),
        plan_type:$('cm-plan').value,
        duration_months:parseInt($('cm-dur').value),
        max_uses:parseInt($('cm-x').value)||100,
        used_count:0,
        expires_at:$('cm-e').value||null
    };
    if(!obj.code){toast('Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯',false);return}
    if(discType!=='free'&&!obj.discount_value){toast('Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…',false);return}
    var{error}=await sb.from('coupons').insert(obj);
    if(error)toast('Ø®Ø·Ø£: '+error.message,false);
    else{toast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ† âœ“',true);$('couponM').classList.add('hidden');loadC()}
}
async function delC(id){if(!confirm('Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†ØŸ'))return;await sb.from('coupons').delete().eq('id',id);toast('ØªÙ…',true);loadC()}

async function loadF(){
    var{data}=await sb.from('profiles').select('subscription_type');
    if(!data)return;
    var m=data.filter(function(u){return u.subscription_type==='monthly'}).length;
    var y=data.filter(function(u){return u.subscription_type==='yearly'}).length;
    var f=data.filter(function(u){return!u.subscription_type||u.subscription_type==='free'}).length;
    $('f-a').textContent=m+y;$('f-m').textContent=m;$('f-y').textContent=y;$('f-f').textContent=f;
}

// âœ… Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ù…Ø­Ø³Ù‘Ù†Ø© â€” Ù…Ø¹ Ø²Ø± ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„
async function loadR(){
    var{data}=await sb.from('reports').select('*,questions(id,question_text,section)').order('reported_at',{ascending:false});
    if(!data||!data.length){$('r-list').innerHTML='<div class="glass p-8 text-center text-purple-200/60">Ù…Ø§ ÙÙŠÙ‡ Ø¨Ù„Ø§ØºØ§Øª</div>';return}
    var h='';
    data.forEach(function(r){
        var qText=r.questions?r.questions.question_text.substring(0,100)+'...':'(Ø³Ø¤Ø§Ù„ Ù…Ø­Ø°ÙˆÙ)';
        var qId=r.questions?r.questions.id:null;
        var editBtn=qId?'<button class="bs" style="font-size:.8rem;padding:6px 12px" onclick="editQfromReport(\''+qId+'\')">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„</button>':'';
        h+='<div class="glass p-4">'
          +'<div class="flex items-start justify-between gap-3">'
          +'<div class="flex-1">'
          +'<p class="text-white text-sm font-bold">'+qText+'</p>'
          +'<p class="text-purple-200/70 text-xs mt-1">Ø§Ù„Ø³Ø¨Ø¨: <span class="text-yellow-300">'+(r.reason||'â€”')+'</span></p>'
          +'<p class="text-purple-200/50 text-xs mt-1">'+( r.reported_at?new Date(r.reported_at).toLocaleDateString('ar-SA',{year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'}):'')+'</p>'
          +'</div>'
          +'<div class="flex gap-2 flex-shrink-0">'
          +editBtn
          +'<button class="bd" style="font-size:.8rem;padding:6px 12px" onclick="delR(\''+r.id+'\')">âœ• Ø±ÙØ¶</button>'
          +'</div></div></div>';
    });
    $('r-list').innerHTML=h;
}

// âœ… ÙØªØ­ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ù† Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª
async function editQfromReport(qid){
    var{data}=await sb.from('questions').select('*').eq('id',qid).single();
    if(!data){toast('Ø§Ù„Ø³Ø¤Ø§Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯',false);return}
    // Ø§Ù†ØªÙ‚Ù„ Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
    document.querySelectorAll('.tab').forEach(function(s){s.classList.remove('on')});
    document.querySelectorAll('.sb-link').forEach(function(l){l.classList.remove('on')});
    $('t-questions').classList.add('on');
    document.querySelector('[data-tab="questions"]').classList.add('on');
    await loadQ();
    openQM(data);
}

async function delR(id){await sb.from('reports').delete().eq('id',id);toast('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¨Ù„Ø§Øº',true);loadR()}

async function loadST(){
    var{data}=await sb.from('profiles').select('*').in('role',['admin','staff']).order('created_at');
    if(!data)data=[];
    var icons={questions:'ğŸ“',users:'ğŸ‘¥',finance:'ğŸ’°',coupons:'ğŸŸï¸',reports:'ğŸš©',settings:'âš™ï¸'};
    var rows='';
    data.forEach(function(s){
        var isAdmin=s.role==='admin';
        var badge=isAdmin?'<span class="badge-admin">Ø£Ø¯Ù…Ù†</span>':'<span class="badge-staff">Ù…ÙˆØ¸Ù</span>';
        var permHtml='';
        if(isAdmin){permHtml='<span style="color:rgba(248,113,113,0.6);font-size:.75rem">ÙƒÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</span>'}
        else{
            var perms=s.permissions?(typeof s.permissions==='string'?JSON.parse(s.permissions):s.permissions):{};
            var active=Object.keys(icons).filter(function(p){return perms[p]});
            permHtml=active.length?active.map(function(p){return'<span style="font-size:1rem">'+icons[p]+'</span>'}).join(' '):'<span style="color:rgba(196,181,253,0.3);font-size:.75rem">Ù„Ø§ ØµÙ„Ø§Ø­ÙŠØ§Øª</span>';
        }
        var acts=s.id!==me.id
            ?'<button class="bs" style="padding:5px 10px;font-size:.8rem;margin-left:4px" onclick=\'editST('+JSON.stringify(s)+')\'> âœï¸</button><button class="bd" style="padding:5px 10px;font-size:.8rem" onclick="rmST(\''+s.id+'\')">Ø¥Ø²Ø§Ù„Ø©</button>'
            :'<span style="color:rgba(196,181,253,0.4);font-size:.8rem">Ø£Ù†Øª</span>';
        rows+='<tr class="tr"><td class="p-3 font-bold">'+(s.full_name||'â€”')+'</td><td class="p-3 text-purple-200/70 text-sm">'+(s.email||'')+'</td><td class="p-3 text-center">'+badge+'</td><td class="p-3 text-center">'+permHtml+'</td><td class="p-3 text-center whitespace-nowrap">'+acts+'</td></tr>';
    });
    $('st-list').innerHTML=rows||'<tr><td colspan="5" class="p-6 text-center" style="color:rgba(196,181,253,0.4)">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ†</td></tr>';
}
function editST(s){openStaffModal(s)}
async function rmST(id){if(!confirm('Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸ÙØŸ'))return;await sb.from('profiles').update({role:'user',permissions:null}).eq('id',id);toast('ØªÙ… Ø§Ù„Ø¥Ø²Ø§Ù„Ø©',true);loadST()}

async function loadSet(){
    var{data}=await sb.from('site_settings').select('*');
    if(data)data.forEach(function(s){
        if(s.key==='banner_text')$('st-ban').value=s.value||'';
        if(s.key==='free_limit')$('st-fl').value=s.value||'10';
        if(s.key==='price_monthly')$('st-m').value=s.value||'29';
        if(s.key==='price_yearly')$('st-y').value=s.value||'228';
        if(s.key==='price_monthly_orig')$('st-mo').value=s.value||'39';
        if(s.key==='price_yearly_orig')$('st-yo').value=s.value||'348';
    });
}
async function saveSt(k,v){
    var{data:e}=await sb.from('site_settings').select('id').eq('key',k).single();
    if(e)await sb.from('site_settings').update({value:v}).eq('key',k);
    else await sb.from('site_settings').insert({key:k,value:v});
    toast('ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ“',true);
}
function savePrice(){saveSt('price_monthly',$('st-m').value);saveSt('price_yearly',$('st-y').value);saveSt('price_monthly_orig',$('st-mo').value);saveSt('price_yearly_orig',$('st-yo').value)}

// âœ… Ø¥Ø®ÙØ§Ø¡ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ… Ù„Ùˆ Ù…Ø¬Ø§Ù†ÙŠ
$('cm-t').addEventListener('change',function(){
    $('cm-val-wrap').style.display=this.value==='free'?'none':'block';
});

updateSubSec();
initEditors();
document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
