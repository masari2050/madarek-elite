<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ุงุฎุชุฑ ุงููุณู - ูุณุงุฑู</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body { font-family: 'Tajawal', sans-serif; }
  </style>
</head>

<body class="bg-slate-50 min-h-screen">
  <!-- Top Bar -->
  <div class="max-w-6xl mx-auto px-4 py-6 flex items-center justify-between">
    <div class="text-xl font-bold text-slate-800">ุงุฎุชุฑ ุงููุณู</div>
    <a href="dashboard.html" class="text-slate-600 hover:text-slate-900 font-medium">ุงูุนูุฏุฉ ูููุญุฉ โ</a>
  </div>

  <!-- Header -->
  <div class="max-w-6xl mx-auto px-4">
    <div class="text-center mb-10">
      <h1 class="text-4xl font-extrabold text-slate-800 mb-2">ุงุฎุชุฑ ุงููุณู ููุชุฏุฑูุจ</h1>
      <p class="text-slate-600">ุงุจุฏุฃ ุงูุชุฏุฑูุจ ูุจุงุดุฑุฉ ุญุณุจ ุงููุณู</p>
    </div>

    <!-- Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

      <!-- Quant -->
      <div class="bg-white rounded-2xl border border-blue-100 shadow-sm p-6">
        <div class="flex items-center justify-between mb-4">
          <div>
            <div class="text-2xl font-extrabold text-slate-800">ูุฏุฑุงุช ููู</div>
            <div class="text-slate-600">ุงูุฑูุงุถูุงุช ูุงูุญุณุงุจ</div>
          </div>
          <div class="w-12 h-12 rounded-xl bg-blue-600 text-white flex items-center justify-center text-2xl">๐</div>
        </div>

        <ul class="text-slate-700 space-y-1 mb-5">
          <li>โ ุงูุฌุจุฑ ูุงููุนุงุฏูุงุช</li>
          <li>โ ุงูููุฏุณุฉ</li>
          <li>โ ุงููุณุจุฉ ูุงูุชูุงุณุจ</li>
          <li>โ ุงูุฅุญุตุงุก</li>
        </ul>

        <div class="flex items-center gap-3">
          <div class="flex-1 bg-blue-50 text-blue-800 rounded-xl py-3 text-center font-bold" id="count-quant">...</div>
        </div>

        <button
          class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition"
          id="btn-quant"
        >
          ุงุจุฏุฃ ุงูุชุฏุฑูุจ
        </button>

        <div class="mt-3 text-xs text-slate-500" id="status-quant"></div>
      </div>

      <!-- Verbal -->
      <div class="bg-white rounded-2xl border border-green-100 shadow-sm p-6">
        <div class="flex items-center justify-between mb-4">
          <div>
            <div class="text-2xl font-extrabold text-slate-800">ูุฏุฑุงุช ููุธู</div>
            <div class="text-slate-600">ุงููุบุฉ ุงูุนุฑุจูุฉ</div>
          </div>
          <div class="w-12 h-12 rounded-xl bg-green-600 text-white flex items-center justify-center text-2xl">๐</div>
        </div>

        <ul class="text-slate-700 space-y-1 mb-5">
          <li>โ ุงูุชูุงุธุฑ ุงูููุธู</li>
          <li>โ ุฅููุงู ุงูุฌูู</li>
          <li>โ ุงูุฎุทุฃ ุงูุณูุงูู</li>
          <li>โ ุงูุงุณุชูุนุงุจ ุงูููุฑูุก</li>
        </ul>

        <div class="flex items-center gap-3">
          <div class="flex-1 bg-green-50 text-green-800 rounded-xl py-3 text-center font-bold" id="count-verbal">...</div>
        </div>

        <button
          class="mt-4 w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl transition"
          id="btn-verbal"
        >
          ุงุจุฏุฃ ุงูุชุฏุฑูุจ
        </button>

        <div class="mt-3 text-xs text-slate-500" id="status-verbal"></div>
      </div>

      <!-- Achievement -->
      <div class="bg-white rounded-2xl border border-purple-100 shadow-sm p-6">
        <div class="flex items-center justify-between mb-4">
          <div>
            <div class="text-2xl font-extrabold text-slate-800">ุงูุชุญุตููู</div>
            <div class="text-slate-600">ุงูููุงุฏ ุงูุฏุฑุงุณูุฉ</div>
          </div>
          <div class="w-12 h-12 rounded-xl bg-purple-600 text-white flex items-center justify-center text-2xl">๐</div>
        </div>

        <ul class="text-slate-700 space-y-1 mb-5">
          <li>โ ุงูุฑูุงุถูุงุช</li>
          <li>โ ุงูููุฒูุงุก</li>
          <li>โ ุงูููููุงุก</li>
          <li>โ ุงูุฃุญูุงุก</li>
        </ul>

        <div class="flex items-center gap-3">
          <div class="flex-1 bg-purple-50 text-purple-800 rounded-xl py-3 text-center font-bold" id="count-ach">...</div>
        </div>

        <button
          class="mt-4 w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-xl transition"
          id="btn-ach"
        >
          ุงุจุฏุฃ ุงูุชุฏุฑูุจ
        </button>

        <div class="mt-3 text-xs text-slate-500" id="status-ach"></div>
      </div>

    </div>
  </div>

  <script>
    // โ ุนุฏูููุง ุฅุฐุง ูุดุฑูุนู ูุฎุชูู
    const SUPABASE_URL = 'https://czzcmbxejxbotjemyuqf.supabase.co';
    const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN6emNtYnhlanhib3RqZW15dXFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxNzQ0ODEsImV4cCI6MjA4NTc1MDQ4MX0.xDfG1qsDZGyUrpL44JfqOtk57dVsLaMsvIzJz1KgiR0';

    const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

    const SUBJECTS = {
      quant: 'ูุฏุฑุงุช ููู',
      verbal: 'ูุฏุฑุงุช ููุธู',
      ach: 'ุชุญุตููู'
    };

    const els = {
      countQuant: document.getElementById('count-quant'),
      countVerbal: document.getElementById('count-verbal'),
      countAch: document.getElementById('count-ach'),
      btnQuant: document.getElementById('btn-quant'),
      btnVerbal: document.getElementById('btn-verbal'),
      btnAch: document.getElementById('btn-ach'),
      stQuant: document.getElementById('status-quant'),
      stVerbal: document.getElementById('status-verbal'),
      stAch: document.getElementById('status-ach'),
    };

    function setStatus(el, msg) { el.textContent = msg || ''; }

    async function requireAuth() {
      const { data: { session }, error } = await sb.auth.getSession();
      if (error) console.warn('getSession error:', error);
      if (!session) window.location.href = 'login.html';
    }

    async function countBySubject(subjectLabel) {
      // head:true ูุฑุฌุน count ุจุฏูู ุชุญููู ุงูุตููู
      const { count, error } = await sb
        .from('questions')
        .select('id', { count: 'exact', head: true })
        .eq('subject', subjectLabel);

      if (error) throw error;
      return count || 0;
    }

    async function loadCounts() {
      try {
        setStatus(els.stQuant, 'ุฌุงุฑู ุงูุชุญููู...');
        setStatus(els.stVerbal, 'ุฌุงุฑู ุงูุชุญููู...');
        setStatus(els.stAch, 'ุฌุงุฑู ุงูุชุญููู...');

        const [cq, cv, ca] = await Promise.all([
          countBySubject(SUBJECTS.quant),
          countBySubject(SUBJECTS.verbal),
          countBySubject(SUBJECTS.ach),
        ]);

        els.countQuant.textContent = `${cq} ุณุคุงู ูุชุงุญ`;
        els.countVerbal.textContent = `${cv} ุณุคุงู ูุชุงุญ`;
        els.countAch.textContent = `${ca} ุณุคุงู ูุชุงุญ`;

        els.btnQuant.disabled = cq === 0;
        els.btnVerbal.disabled = cv === 0;
        els.btnAch.disabled = ca === 0;

        if (cq === 0) els.btnQuant.classList.add('opacity-50','cursor-not-allowed');
        if (cv === 0) els.btnVerbal.classList.add('opacity-50','cursor-not-allowed');
        if (ca === 0) els.btnAch.classList.add('opacity-50','cursor-not-allowed');

        setStatus(els.stQuant, cq ? '' : 'ูุง ููุฌุฏ ุฃุณุฆูุฉ ุงูุขู');
        setStatus(els.stVerbal, cv ? '' : 'ูุง ููุฌุฏ ุฃุณุฆูุฉ ุงูุขู');
        setStatus(els.stAch, ca ? '' : 'ูุง ููุฌุฏ ุฃุณุฆูุฉ ุงูุขู');

        // ุชุฎุฒูู ุงูุฃุฑูุงู ููุงุณุชุฎุฏุงู ุฅู ุงุญุชุฌุช ุจุตูุญุฉ ุซุงููุฉ
        localStorage.setItem('masari_counts', JSON.stringify({ cq, cv, ca }));

      } catch (e) {
        console.error('loadCounts failed:', e);
        els.countQuant.textContent = 'ุชุนุฐุฑ ุงูุชุญููู';
        els.countVerbal.textContent = 'ุชุนุฐุฑ ุงูุชุญููู';
        els.countAch.textContent = 'ุชุนุฐุฑ ุงูุชุญููู';
        setStatus(els.stQuant, e.message || 'ุฎุทุฃ');
        setStatus(els.stVerbal, e.message || 'ุฎุทุฃ');
        setStatus(els.stAch, e.message || 'ุฎุทุฃ');
      }
    }

    function startTraining(subjectLabel) {
      // ูุฎุฒู ููุณ ุงููุต ุงููุทุงุจู ููุงุนุฏุฉ ุงูุจูุงูุงุช
      localStorage.setItem('masari_selected_subject', subjectLabel);
      // ููุฑุฑู ุฃูุถูุง ูู ุงูุฑุงุจุท (ุฃูุถู ููุชุชุจุน)
      window.location.href = `practice.html?subject=${encodeURIComponent(subjectLabel)}`;
    }

    els.btnQuant.addEventListener('click', () => startTraining(SUBJECTS.quant));
    els.btnVerbal.addEventListener('click', () => startTraining(SUBJECTS.verbal));
    els.btnAch.addEventListener('click', () => startTraining(SUBJECTS.ach));

    (async () => {
      await requireAuth();
      await loadCounts();
    })();
  </script>
</body>
</html>
